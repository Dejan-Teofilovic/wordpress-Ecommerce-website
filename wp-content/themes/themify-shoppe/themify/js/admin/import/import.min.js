let TF_Import;((S,N,k)=>{'use strict';TF_Import={importImages(){return S.loadJs(S.url+'js/admin/import/import-images',!!N.TF_ImportImages)},init(j,A,O,I,v,T){return new Promise(async(t,e)=>{let m=!0;this.importImages(),await S.loadJs(S.url+'js/admin/notification',!!N.TF_Notification);const i=j.length,r=12<i?150:100,c=I.import_skip,g=[],l=0<I.limit?parseInt(I.limit):5,n=I.images_chunk,s=!!I.skip_builder,_=i=>{const l=[];for(let e=0,t=i.length;e<t;++e){let t='';i[e].tbp_template_name!==k?t=i[e].tbp_template_name:i[e].post_title!==k?t=i[e].post_title:i[e].title!==k?t=i[e].title.rendered!==k?i[e].title.rendered:i[e].title:i[e].name===k&&i[e].post_name===k||(t=i[e].name),t!==k&&''!==t&&l.push(t)}return 0===l.length?'':l.join(', ')},h=l=>new Promise((e,i)=>{setTimeout(()=>{let t={action:A,id:v||'',nonce:O,data:l};I.custom_params&&(t=Object.assign(t,I.custom_params)),S.fetch(t).then(t=>{(t&&t.success&&t.data?e:i)(t)}).catch(i)},r)}),o=()=>{m='visible'===N.document.visibilityState},d=(t,e)=>{const i=[];for(;0<t.length;)i.push(t.splice(0,e));return i},a=(e,p)=>new Promise(async t=>{let l=0,s=new Set,r=e.length,o=I.loading.replaceAll('%to%',r),a=d(e,p);for(let t=0;t<a.length;++t){let n=a[t];if(0<n.length){let e=_(n),i;if(1<r&&!0===m){l+=n.length;let t=o.replaceAll('%from%',l).replaceAll('%post%',e);120<t.length&&(t=t.slice(0,120)+'...'),await TF_Notification.show('info',t)}try{i=await h(n)}catch(t){try{i=await h(new Blob([JSON.stringify(n)],{type:'application/json'}))}catch(t){}}finally{if(i&&i.success&&i.data){let r=!1;const f=i.data;for(let i in f){let l=f[i];for(let e=n.length-1;-1<e;--e)if(n[e]!==k){let t=n[e].term_id||n[e].ID||n[e].post_id;if(i==t){if(!1===l)s.add(n[e]);else if('object'==typeof l||isNaN(l)){let t='object'==typeof l?l.msg:l;if(!0===m&&await TF_Notification.showHide('warning',c.replaceAll('%post%',_([n[e]]))+':'+t,2e3),'object'==typeof l&&l.skip){for(let e=n.length-1;-1<e;--e){let t=n[e].post_type||n[e].taxonomy;t===l.skip&&n.splice(e,1)}for(let i=a.length-1;-1<i;--i){for(let e=a[i].length-1;-1<e;--e){let t=a[i][e].post_type||a[i][e].taxonomy;t===l.skip&&(a[i].splice(e,1),r=!0)}0===a[i].length&&a.splice(i,1)}}}else!0!==l&&(n[e].term_thumb?g.push({term_id:l,url:n[e].term_thumb.trim()}):n[e].thumb&&g.push({id:l,url:n[e].thumb.trim()}));n[e]!==k&&n.splice(e,1);break}}}if(!0===r){for(let t=(a=a.flat()).length-1;-1<t;--t)0===a[t].length&&a.splice(t,1);t=-1,a=d(a,p)}}else{!0===m&&await TF_Notification.showHide('error',c.replaceAll('%post%',e),2e3);for(let t=n.length-1;-1<t;--t)s.add(n[t])}}}}t(s)}),f=t=>(t.preventDefault(),t.returnValue='Are you sure'),p=l=>{if(!Array.isArray(l)){const e=[];for(let t in l)e.push(l[t]);l=e}for(let t=l.length-1;-1<t;--t){let i=l[t].cols;if(i){if(!Array.isArray(i)){let e=[];for(let t in i)e.push(i[t]);i=l[t].cols=e}for(let t=i.length-1;-1<t;--t)i[t].modules&&(i[t].modules=p(i[t].modules))}}return l},u=i=>{for(let t=i.length-1;-1<t;--t){if(i[t].styling&&0<Object.keys(i[t].styling).length)return!0;let e=i[t].modules;if(e&&0<e.length)for(let t=e.length-1;-1<t;--t){if(!e[t].cols)return!0;if(u(e[t].cols))return!0}}return!1};N.tfOff('beforeunload',f).tfOn('beforeunload',f).document.tfOff('visibilitychange',o,{passive:!0}).tfOn('visibilitychange',o,{passive:!0});let y=new Map;I.custom_data=v||'default',I.stop_webp=1;try{let l=new Set;for(let t=j.length-1;-1<t;--t){let i=(j[t].meta_input||j[t])._themify_builder_settings_json;if(i){'string'==typeof i&&(i=JSON.parse(i)),i=p(i);let e=!1;for(let t=i.length-1;-1<t;--t)if(i[t].styling&&0<Object.keys(i[t].styling).length||i[t].cols&&u(i[t].cols)){e=!0;break}if(!1===e)j[t].meta_input?delete j[t].meta_input._themify_builder_settings_json:delete j[t]._themify_builder_settings_json;else if(0==s){let t=(t=>{const i=new Set,r=t=>{if(t){const e=t.split('?')[0].split('.');-1!==['jpg','jpeg','tiff','png','gif','bmp','svg','webp','apng'].indexOf(e[e.length-1])&&i.add(t)}},l=e=>{for(let t in e)if(e[t])if(Array.isArray(e[t])||'object'==typeof e[t])l(e[t]);else{let i=e[t].toString().trim();if(i)if(-1!==i.indexOf('<img ')){let t=document.createElement('template'),l=(t.innerHTML=i,t.content.querySelectorAll('img'));for(let i=l.length-1;-1<i;--i){let t=l[i].src,e=l[i].srcset;e=e?e.split(' '):[],t&&e.push(t);for(let t=e.length-1;-1<t;--t)e[t]&&r(e[t].trim())}}else if('['===i[0]&&-1!==i.indexOf('path=')){let e=i.match(/\path.*?=.*?[\'"](.+?)[\'"]/gim);if(e&&e[0])for(let t=(e=e[0].split('path=')[1].replaceAll('"','').replace("'",'').split(',')).length-1;-1<t;--t)e[t]&&r(e[t].trim())}else r(i)}};return l(t),i})(i);0<t.size&&(l=new Set([...l,...t]))}}if(j[t]._product_image_gallery){let e=j[t]._product_image_gallery;for(let t=(e='string'==typeof e?e.split(','):e).length-1;-1<t;--t)l.add(e[t].trim())}}if(0<l.size){await this.importImages(),y=await TF_ImportImages.init([...l],O,I,n,T);for(let r=j.length-1;-1<r;--r){let i=(j[r].meta_input||j[r])._themify_builder_settings_json;if(i){'string'!=typeof i&&(i=JSON.stringify(i));for(let[t,e]of y)!1!==e&&e.src&&(-1!==i.indexOf(t)&&(i=i.replaceAll(t,e.src)),j[r].post_content&&-1!==j[r].post_content.indexOf(t)&&(j[r].post_content=j[r].post_content.replaceAll(t,e.src)));i=JSON.parse(i),j[r].meta_input&&j[r].meta_input._themify_builder_settings_json?j[r].meta_input._themify_builder_settings_json=i:j[r]._themify_builder_settings_json=i}if(j[r]._product_image_gallery){let i=j[r]._product_image_gallery,l=[];i='string'==typeof i?i.split(','):i;for(let e=0,t=i.length;e<t;++e){let t=y.get(i[e].trim());t&&l.push(t.id)}0<l.length?j[r]._product_image_gallery=l.join(','):delete j[r]._product_image_gallery}}}}catch(t){}let b=await a(j,l);if(0<b.size&&0<(b=await a([...b],2)).size&&!0===m&&await TF_Notification.showHide('error',I.import_failed.replaceAll('%post%',_(Array.from(b))),4e3),b.size===i)e(Array.from(b));else{if(0<g.length){await this.importImages();try{const w=await TF_ImportImages.init(g,O,I,n,T);y=new Map([...w,...y])}catch(t){}}t([y,b])}N.tfOff('beforeunload',f).document.tfOff('visibilitychange',o,{passive:!0})})},sort(r,n,s){const o=new Set,a=t=>{const e=parseInt(s===k?t[n]:t[n][s]),i=0<t.term_id?'term_id':'ID';for(var l=r.length-1;-1<l;--l)if(0<r[l][i]&&parseInt(r[l][i])===e){let t=r[l][n];0<(t=s!==k?t[s]:t)&&a(r[l]),o.add(r[l])}};for(var e=r.length-1;-1<e;--e){let t=r[e][n];(t=s!==k?t[s]:t)!==k&&0!=t||(o.add(r[e]),r.splice(e,1))}for(e=r.length-1;-1<e;--e){let t=r[e][n];0<(t=s!==k?t[s]:t)&&(a(r[e]),o.add(r[e]))}return[...o]}}})(Themify,window.top,void 0);