((o,$,l,a,r)=>{'use strict';let n=!!r.is_gutenberg_editor;if(null!==l.querySelector('#page-builder.themify_write_panel'))n=!1,l.body.classList.remove('themify-gutenberg-editor');else if(!n)return;const t={init(){const t=l.tfId('tb_canvas_block');n&&!t?o.on('tb_canvas_loaded',()=>{this.init()},!0):(o.is_builder_active=!0,Promise.all([this.render(),a.jsModuleLoaded()]).then(()=>{'#builder_active'===window.location.hash&&(window.location.hash='',this.scrollToBuilder());let t=l.tfClass('tb_wp_editor_holder')[0],e=l.createElement('a');if(e.href='#',e.className='button tb_switch_frontend',e.textContent=r.i18n.switchToFrontendLabel,t)e=t.tfTag('a')[0];else{const i=l.querySelector('#postdivrich #wp-content-media-buttons');i&&i.appendChild(e)}e&&e.isConnected&&e.tfOn(o.click,t=>{t.preventDefault(),o.triggerEvent(a.ToolBar.el.tfClass('switch')[0],t.type)}),a.Registry.trigger(a.Builder.get(),'tb_init'),o.trigger('themify_builder_ready'),o.on('tb_scroll_to_builder',()=>{this.scrollToBuilder()}),a.is_builder_ready=!0}))},scrollToBuilder(){const t=l.tfId('page-buildert'),e=a.ToolBar.el;if(null!==t&&t.click(),n)a.Utils.scrollTo(e.getRootNode().host);else{let t=l.tfId('wpadminbar');t=t?t.offsetHeight:0,o.scrollTo(e.getBoundingClientRect().top-t)}},render(){const t=l.tfId('tmpl-builder_admin_canvas_block').content;if(n){const i=l.tfId('tb_canvas_block');i.innerHTML='',i.appendChild(t)}else l.tfId('tb_builder_placeholder').replaceWith(t);const e=a.Helper.correctBuilderData(r.builder_data);return a.FormTemplates.init().then(()=>{const t=l.tfId('tb_row_wrapper').firstElementChild;ThemifyStyles.init(a.FormTemplates.getItem(),a.breakpointsReverse,t.dataset.postid,themifyBuilder.gutters),new a.Builder(t,e,r.custom_css),this.initEvents()})},initEvents(){let i=!1;const e=l.querySelectorAll('input#publish,input#save-post,button.editor-post-publish-button__button,.editor-post-save-draft'),s=t=>{if(!1===i){i=!0,t.stopImmediatePropagation(),n||t.preventDefault();const e=t.currentTarget;this.saveCallback(t.currentTarget).finally(()=>{e.click(),e.tfOn(o.click,s,{once:!0}),i=!1})}};for(let t=e.length-1;-1<t;--t)e[t].tfOn(o.click,s,{once:!0});o.on('tb_switch_frontend',t=>{this.switchFrontend(t)})},saveCallback(t){return n?t.setAttribute('aria-disabled','true'):t.classList.add('disabled'),a.ToolBar.save().then(()=>{a.undoManager.reset(),n?t.setAttribute('aria-disabled','false'):t.classList.remove('disabled')})},switchFrontend(s){let a,t=l.tfId('original_post_status');t=t&&t.value,(a='publish'===t?n?l.tfClass('editor-post-publish-button__button')[0]:l.tfId('publish'):n?l.tfClass('editor-post-save-draft')[0]:l.tfId('save-post'))&&this.saveCallback(a).then(()=>{if(n){const t=l.tfClass('editor-post-publish-button')[0];if(t){const e=new MutationObserver((t,e)=>{const i=t[0].target;setTimeout(()=>{i.classList.contains('is-busy')||l.tfClass('editor-post-saved-state')[0]||(window.location.href=s)},150)});e.observe(t,{attributes:!0})}}else{const i=l.tfId('page-builder');if(i&&!l.tfId('tb_switch_frontend')){let t=l.createElement('input');t.type='hidden',t.name=t.id='tb_switch_frontend',t.value='yes',i.appendChild(t)}}o.triggerEvent(a,o.click)})}},e=()=>{t.init(),'function'==typeof window.icl_copy_from_original&&$.ajaxPrefilter((t,e)=>{if(e.data&&'string'==typeof e.data&&e.data.includes('icl_ajx_action=copy_from_original')){const i=t.success,s=new URLSearchParams(e.data);t.success=t=>{const e=$('#tb_canvas_block');e.length&&e.hide().appendTo('body'),i(t),e.length&&$('#editor [data-type="themify-builder/canvas"]').empty().append(e.show()),$.ajax({url:ajaxurl,type:'POST',data:{action:'themify_builder_icl_copy_from_original',source_page_id:s.get('trid'),source_page_lang:s.get('lang')},success(t){if('-1'!=t){let e;try{e=JSON.parse(t)||{}}catch(t){e={}}a.Builder.get().reLoad(e,r.post_ID)}}})}}})};'complete'===l.readyState?e():window.tfOn('load',e,{once:!0,passive:!0})})(Themify,jQuery,document,tb_app,themifyBuilder);