!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(s,t){function o(t,e){this._name=n,this.el=t,this.$el=s(t),this.$el.prop("multiple")||(this.settings=s.extend({},i,e,this.$el.data()),this._defaults=i,this.$options=this.$el.find("option, optgroup"),this.init(),s.fn[n].instances.push(this))}var n="comboSelect",r="comboselect",i={comboClass:"combo-select",comboArrowClass:"combo-arrow",comboDropDownClass:"combo-dropdown",inputClass:"combo-input text-input",disabledClass:"themify-combo-disabled",hoverClass:"option-hover",selectedClass:"option-selected",markerClass:"combo-marker",themeClass:"",maxHeight:200,extendStyle:!0,focusInput:!0},e=27,c=9,h=37,l=38,a=39,u=40,p=13,d=16,f=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());s.extend(o.prototype,{init:function(){this._construct(),this._events()},_construct:function(){this.$el.data("plugin_"+r+"_tabindex",this.$el.prop("tabindex")),!f&&this.$el.prop("tabIndex",-1),this.$container=this.$el.wrapAll('<div class="'+this.settings.comboClass+" "+this.settings.themeClass+'" />').parent(),this.settings.extendStyle&&this.$el.attr("style")&&this.$container.attr("style",this.$el.attr("style")),this.$arrow=s('<div class="'+this.settings.comboArrowClass+'" />').appendTo(this.$container),this.$dropdown=s('<ul class="'+this.settings.comboDropDownClass+'" />').appendTo(this.$container),this._build(),this.$input=s('<input type="text"'+(f?'tabindex="-1"':"")+' placeholder="'+this.getPlaceholder()+'" class="'+this.settings.inputClass+'">').appendTo(this.$container),this._updateInput()},getPlaceholder:function(){var i="";return this.$options.filter(function(t,e){return"OPTION"==e.nodeName}).each(function(t,e){""==e.value&&(i=e.innerHTML)}),i},_build:function(){var i=this,s="",o=0;this.$options.each(function(t,e){return"optgroup"==e.nodeName.toLowerCase()?s+='<li class="themify-combo-group">'+this.label+"</li>":(s+='<li class="'+(this.disabled?i.settings.disabledClass:"themify-combo-item")+" "+(o==i.$el.prop("selectedIndex")?i.settings.selectedClass:"")+'" tabindex="-1" data-index="'+o+'" data-value="'+this.value+'" style="font-family:'+this.value+'">'+this.innerHTML+"</li>",void o++)}),this.$dropdown.html(s),this.$items=this.$dropdown.children()},_events:function(){this.$container.on("focus.input","input",s.proxy(this._focus,this)),this.$container.on("mouseup.input","input",function(t){t.preventDefault()}),this.$container.on("blur.input","input",s.proxy(this._blur,this)),this.$el.on("change.select",s.proxy(this._change,this)),this.$el.on("focus.select",s.proxy(this._focus,this)),this.$el.on("blur.select",s.proxy(this._blurSelect,this)),this.$container.on("click.arrow","."+this.settings.comboArrowClass,s.proxy(this._toggle,this)),this.$container.on("comboselect:close",s.proxy(this._close,this)),this.$container.on("comboselect:open",s.proxy(this._open,this)),this.$container.on("comboselect:update",s.proxy(this._update,this)),s([document,top.document]).off("click.comboselect").on("click.comboselect",function(){s.each(s.fn[n].instances,function(t,e){e.$container.trigger("comboselect:close")})}),this.$container.on("click.comboselect",function(t){t.stopPropagation()}),this.$container.on("keydown","input",s.proxy(this._keydown,this)),this.$container.on("keyup","input",s.proxy(this._keyup,this)),this.$container.on("click.item",".themify-combo-item",s.proxy(this._select,this))},_keydown:function(t){switch(t.which){case l:this._move("up",t);break;case u:this._move("down",t);break;case c:this._enter(t);break;case a:this._autofill(t);break;case p:this._enter(t)}},_keyup:function(t){switch(t.which){case e:this.$container.trigger("comboselect:close");break;case p:case l:case u:case h:case a:case c:case d:break;default:this._filter(t.target.value)}},_enter:function(t){var e=this._getHovered();if(e.length&&this._select(e),t&&t.which==p){if(!e.length)return this._blur(),!0;t.preventDefault()}},_move:function(t){var e=this._getVisible(),i=this._getHovered().prevAll(".themify-combo-item").filter(":visible").length,s=e.length;switch(t){case"up":--i<0&&(i=s-1);break;case"down":s<=++i&&(i=0)}e.removeClass(this.settings.hoverClass).eq(i).addClass(this.settings.hoverClass),this.opened||this.$container.trigger("comboselect:open"),this._fixScroll()},_select:function(t){var e=s(t.currentTarget?t.currentTarget:t);if(e.length){var i=e.data("index");this._selectByIndex(i),this.$input.focus(),this.$container.trigger("comboselect:close")}},_selectByIndex:function(t){void 0===t&&(t=0),this.$el.prop("selectedIndex")!=t&&this.$el.prop("selectedIndex",t).trigger("change")},_autofill:function(){var t=this._getHovered();if(t.length){var e=t.data("index");this._selectByIndex(e)}},_filter:function(t){var i=this,e=this._getAll();needle=s.trim(t).toLowerCase(),reEscape=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),pattern="("+t.replace(reEscape,"\\$1")+")",s("."+i.settings.markerClass,e).contents().unwrap(),needle?(this.$items.filter(".themify-combo-group, .themify-combo-disabled").hide(),e.hide().filter(function(){var t=s(this);return-1!=s.trim(t.text()).toLowerCase().toString().indexOf(needle)?(t.html(function(t,e){return e.replace(new RegExp(pattern,"gi"),'<span class="'+i.settings.markerClass+'">$1</span>')}),!0):void 0}).show()):this.$items.show(),this.$container.trigger("comboselect:open")},_highlight:function(){var t=this._getVisible().removeClass(this.settings.hoverClass),e=t.filter("."+this.settings.selectedClass);e.length?e.addClass(this.settings.hoverClass):t.removeClass(this.settings.hoverClass).first().addClass(this.settings.hoverClass)},_updateInput:function(){var t=this.$el.prop("selectedIndex");return this.$el.val()?(text=this.$el.find("option").eq(t).text(),this.$input.val(text)):this.$input.val(""),this._getAll().removeClass(this.settings.selectedClass).filter(function(){return s(this).data("index")==t}).addClass(this.settings.selectedClass)},_blurSelect:function(){this.$container.removeClass("themify-combo-focus")},_focus:function(t){this.$container.toggleClass("themify-combo-focus",!this.opened),f||(this.opened||this.$container.trigger("comboselect:open"),this.settings.focusInput&&t&&t.currentTarget&&"INPUT"==t.currentTarget.nodeName&&t.currentTarget.select())},_blur:function(){var t=s.trim(this.$input.val().toLowerCase()),e=!isNaN(t),i=this.$options.filter(function(){return"OPTION"==this.nodeName}).filter(function(){return e?parseInt(s.trim(this.innerText).toLowerCase())==t:s.trim(this.innerText).toLowerCase()==t}).prop("index");this._selectByIndex(i)},_change:function(){this._updateInput()},_getAll:function(){return this.$items.filter(".themify-combo-item")},_getVisible:function(){return this.$items.filter(".themify-combo-item").filter(":visible")},_getHovered:function(){return this._getVisible().filter("."+this.settings.hoverClass)},_open:function(){var i=this;this.$container.addClass("themify-combo-open"),this.opened=!0,this.settings.focusInput&&setTimeout(function(){!i.$input.is(":focus")&&i.$input.focus()}),this._highlight(),this._fixScroll(),s.each(s.fn[n].instances,function(t,e){e!=i&&e.opened&&e.$container.trigger("comboselect:close")})},_toggle:function(){this.opened?this._close.call(this):this._open.call(this)},_close:function(){this.$container.removeClass("themify-combo-open themify-combo-focus"),this.$container.trigger("comboselect:closed"),this.opened=!1,this.$items.show()},_fixScroll:function(){if(!this.$dropdown.is(":hidden")){var t=this._getHovered();if(t.length){var e,i,s,o=t.outerHeight();e=t[0].offsetTop,s=(i=this.$dropdown.scrollTop())+this.settings.maxHeight-o,e<i?this.$dropdown.scrollTop(e):s<e&&this.$dropdown.scrollTop(e-this.settings.maxHeight+o)}}},_update:function(){this.$options=this.$el.find("option, optgroup"),this.$dropdown.empty(),this._build()},dispose:function(){this.$arrow.remove(),this.$input.remove(),this.$dropdown.remove(),this.$el.removeAttr("tabindex"),this.$el.data("plugin_"+r+"_tabindex")&&this.$el.prop("tabindex",this.$el.data("plugin_"+r+"_tabindex")),this.$el.unwrap(),this.$el.removeData("plugin_"+r),this.$el.removeData("plugin_"+r+"_tabindex"),this.$el.off("change.select focus.select blur.select")}}),s.fn[n]=function(e,i){return this.each(function(){var t=s(this).data("plugin_"+r);"string"==typeof e?t&&"function"==typeof t[e]&&t[e](i):(t&&t.dispose&&t.dispose(),s.data(this,"plugin_"+r,new o(this,e)))}),this},s.fn[n].instances=[]});