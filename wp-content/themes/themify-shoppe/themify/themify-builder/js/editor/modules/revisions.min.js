let TB_Revisions;((n,r)=>{'use strict';TB_Revisions={async init(e){const t=e.classList;if(t.contains('save_revision')||t.contains('load_revision'))try{await n.LightBox.save(),t.contains('save_revision')?await this.saveRevision():await this.loadRevision(e)}catch(e){throw n.Spinner.showLoader('spinhide'),e}},async loadRevision(e){const t=e.getBoundingClientRect(),i=await this.ajax({action:'tb_load_revision_lists'},'text'),o=(n.LightBox.el.classList.add('tb_revision_lightbox'),n.LightBox.setStandAlone(t.left,t.top),await n.Spinner.showLoader('done'),await n.LightBox.open({contructor:!0,loadMethod:'html',save:!1,data:{revision:{html:i.trim()}}})),s=o.tfClass('tb_revision_lists')[0],a=e=>{const t=e.target.closest('.js-builder-restore-revision-btn,.js-builder-delete-revision-btn');t&&(e.preventDefault(),e.stopPropagation(),t.classList.contains('js-builder-restore-revision-btn')?this.restore(t.dataset.id):this.delete(t))};s&&s.tfOn(r.click,a),r.on('themify_builder_lightbox_close',e=>{s&&s.tfOff(r.click,a),e.classList.remove('tb_revision_lightbox')},!0)},ajax(e,t){const i={sourceEditor:'visual'===n.mode?'frontend':'backend'};return n.Spinner.showLoader(),n.LocalFetch(Object.assign({},i,e),t)},async saveRevision(){n.Spinner.showLoader('spinhide');try{const e=await n.LiteLightBox.prompt(themifyBuilder.i18n.enterRevComment);if(!e||'yes'!==e[0])throw'canceled';await n.LightBox.save();const t={action:'tb_save_revision',rev_comment:e[1]||'',data:JSON.stringify(n.Helper.clear(n.Builder.get().toJSON(!0)))},i=themifyBuilder.i18n.revSaved.replaceAll('%rev_title%',t.rev_comment);try{const o=await this.ajax(t);if(!o.success)throw o.data}catch(e){try{t.data=new Blob([t.data],{type:'application/json'});const s=await this.ajax(t);if(!s.success)throw e}catch(e){throw e}}await Promise.all([n.Spinner.showLoader('done'),TF_Notification.showHide('done',i.replaceAll('%post_title%',themifyBuilder.post_title),2500)])}catch(e){throw e&&'canceled'!==e&&(await n.Spinner.showLoader('error'),n.LiteLightBox.alert(e)),e}},restore(e){const t=()=>{this.ajax({action:'tb_restore_revision_page',revid:e}).then(e=>{e.builder_data?(n.LightBox.close(),n.Builder.get().reLoad(e)):(n.Spinner.showLoader('error'),n.LiteLightBox.alert(e.data))}).catch(e=>{n.Spinner.showLoader('error')})};n.LiteLightBox.confirm({msg:themifyBuilder.i18n.confirmRestoreRev,buttons:{no:ThemifyConstructor.label.save_no,yes:ThemifyConstructor.label.save}}).then(e=>{'yes'===e?this.saveRevision().then(()=>{t()}).catch(e=>{}):t()})},delete(t){n.LiteLightBox.confirm({msg:themifyBuilder.i18n.confirmDeleteRev}).then(e=>{'yes'===e&&(n.Spinner.showLoader(),this.ajax({action:'tb_delete_revision',revid:t.dataset.id}).then(e=>{e.success?n.Spinner.showLoader('done').then(()=>{t.closest('li').remove()}):n.Spinner.showLoader('error').then(()=>{n.LiteLightBox.alert(e.data)})}).catch(()=>{n.Spinner.showLoader('error')}))})}}})(tb_app,Themify);