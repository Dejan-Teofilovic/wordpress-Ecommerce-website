let TB_Layouts;((m,h,_)=>{'use strict';let i=!1,g;const t=-1!==_.createElement('canvas').toDataURL('image/webp').indexOf('data:image/webp');TB_Layouts={el:null,init(e){const t=e.classList;(t.contains('load_layout')||t.contains('save_layout'))&&m.LightBox.save().then(()=>{e.classList.contains('load_layout')?this.loadLayout(e):this.saveLayout(e)}).catch(e=>{m.Spinner.showLoader('spinhide')})},initForm(e){const t=_.createElement('div'),a=_.createElement('form'),l=_.createElement('a'),s=_.createElement('a');return t.className='tb_options_tab_content',a.id='tb_load_template_form',a.method='POST',l.href=themifyBuilder.i18n.layoutAddUrl,s.target=l.target='_blank',l.className='add_new tf_plus_icon tb_icon_btn tf_rel',l.textContent=themifyBuilder.i18n.layoutAddText,s.className='tb_icon_btn',s.href=themifyBuilder.i18n.layoutEditUrl,s.textContent=themifyBuilder.i18n.layoutEditText,s.prepend(m.Helper.getIcon('ti-folder')),a.append(e,l,s),t.appendChild(a),t},loadLayout(e){m.Spinner.showLoader();const t=e.closest('ul').getBoundingClientRect(),a=[];for(let[e,t]of d.instanes){let e=t.data||t.getList();a.push(e)}Promise.all(a).then(n=>{let o=0,r=_.createDocumentFragment(),c=_.createDocumentFragment(),e=_.createElement('div'),t=_.createElement('div');var a;e.className='tb_tabs',t.className='tb_tab_nav tf_clearfix',a=m.LightBox.el.tfClass('tf_scrollbar')[0],g=g||new IntersectionObserver((t,a)=>{for(let e=t.length-1;-1<e;--e)if(!0===t[e].isIntersecting){a.unobserve(t[e].target);let s=t[e].target;if(s&&s.isConnected){let e=s.tfTag('img')[0],t=e.dataset.src,a=new Image(e.getAttribute('width'),e.getAttribute('height')),l=_.createElement('div');l.className='tf_loader tf_abs_c',a.decoding='async',a.src=t,a.title=a.alt=e.alt,s.appendChild(l),a.decode().catch(()=>{}).finally(()=>{e.replaceWith(a),l.remove()})}}},{root:a||null,threshold:.1});for(let[s,i]of d.instanes){let e=_.createElement('li'),t=_.createElement('a'),a=_.createElement('div'),l='tb_tabs_'+s;e.className='title',t.href='javascript:;',t.dataset.id=l,t.textContent=i.title,a.className='tb_tab tf_clear',0===o?e.className+=' current':a.className+=' tf_hide',a.id=l,e.appendChild(t),i.data=n[o],a.appendChild(i.getHtml()),c.appendChild(e),r.appendChild(a),++o}t.appendChild(c),e.append(t,r),this.el=this.initForm(e)}).catch(e=>{this.el=null}).finally(()=>{const e=this.el?'spinhide':'error';m.LightBox.el.classList.add('tb_predesigned_lightbox'),m.Spinner.showLoader(e).then(()=>{const e=this.el||themifyBuilder.i18n.layoutError;m.LightBox.setStandAlone(t.left,t.top),m.LightBox.open({loadMethod:'html',save:!1,data:e}).then(e=>{this.el&&(this.reInitJs(this.el),h.isTouch||setTimeout(()=>{this.el.querySelector('#'+this.el.querySelector('.title.current a').dataset.id).tfClass('tb_layout_search')[0].focus(),this.el=null},125)),h.on('themify_builder_lightbox_close',e=>{e.classList.remove('tb_predesigned_lightbox'),g&&(g.disconnect(),g=null)},!0)})})})},saveLayout(e){m.Spinner.showLoader('spinhide');const t={contructor:!0,loadMethod:'html',save:{},data:{save_as_layout:{options:[{id:'layout_title_field',type:'text',label:ThemifyConstructor.label.title},{id:'layout_img_field',type:'image',label:ThemifyConstructor.label.image_preview},{id:'layout_img_field_id',type:'hidden'},{id:'postid',type:'hidden',value:m.Builder.get().id}]}}},a=e.closest('ul').getBoundingClientRect();m.LightBox.el.classList.add('tb_savead_lightbox'),m.LightBox.setStandAlone(a.left,a.top),m.LightBox.open(t).then(e=>{const t=e.tfClass('builder_save_button')[0],a=e=>{e.stopPropagation(),e.preventDefault();const t=Object.assign({action:'tb_save_custom_layout'},m.Forms.serialize(m.LightBox.el));m.Spinner.showLoader(),m.LocalFetch(t).then(e=>{'success'===e.status?(m.Spinner.showLoader('done'),m.LightBox.close(),this.el=this.json=null):(m.Spinner.showLoader('error'),m.LiteLightBox.alert(e.msg))}).catch(()=>{m.Spinner.showLoader('error')})};t.tfOn(h.click,a),h.on('themify_builder_lightbox_close',e=>{e.classList.remove('tb_savead_lightbox'),t.tfOff(h.click,a)},!0)})},reInitJs(e){e.querySelector('#tb_load_template_form').tfOn(h.click,e=>{const t=e.target?e.target.closest('.tb_layout_thumb'):null;if(t&&(!e.target.closest('a')||'_blank'!==e.target.closest('a').target)){e.preventDefault(),e.stopPropagation();const a=t.closest('li'),s=a.dataset.slug,l={msg:themifyBuilder.i18n.confirm_template_selected,buttons:{no:themifyBuilder.i18n.layout_replace,yes:themifyBuilder.i18n.layout_append}};m.LiteLightBox.confirm(l).then(l=>{if(l){const e=a.closest('ul').dataset.group,t=()=>{const e=m.Helper.cloneObject(m.layouts_selected[s].builder_data),t=e.custom_css;if(!0!==i){const a={action:'set_layout_action',mode:'no'!==l?1:0};m.LocalFetch(a,'text').then(()=>{i=!0})}delete e.custom_css,m.Builder.get().reLoad({builder_data:e,used_gs:m.layouts_selected[s].used_gs,custom_css:t},'no'!==l),m.LightBox.close()};m.layouts_selected||(m.layouts_selected={}),m.layouts_selected[s]?t():(m.Spinner.showLoader(),d.instanes.get(e).getItem(s).then(e=>{e.builder_data=m.Helper.clearElementId(e.builder_data),m.layouts_selected[s]=e,t()}).catch(e=>{m.Spinner.showLoader('error'),m.LiteLightBox.alert(e),m.LightBox.close()}))}})}}).tfOn('submit',e=>{e.preventDefault(),e.stopPropagation()})}};class d{constructor(e){d.instanes.set(e,this)}search(e){const t=e.value.trim().toUpperCase(),a=e.closest('.tb_tab').tfClass('tb_layout_title');for(let e=a.length-1;-1<e;--e)a[e].closest('li').style.display=''===t||-1!==a[e].textContent.toUpperCase().indexOf(t)?'':'none'}clearSearch(e){const t=e.closest('.tb_tab').tfClass('tb_layout_search')[0];t.value='',h.triggerEvent(t,'input')}filter(t){if(!t.classList.contains('current')){const e=t.closest('ul'),l=e.closest('.tb_tab').tfClass('tb_layout_lists')[0].children,s=t.classList.contains('all'),i=''!==themifyBuilder.paths.layouts_index?'*':null,n=t.textContent,a=e.children;for(let a=l.length-1;-1<a;--a){let t=s;if(!t){let e=l[a].dataset.category;e&&(t=n===e||'*'===i&&-1!==e.indexOf(n))}l[a].style.display=t?'':'none'}for(let e=a.length-1;-1<e;--e)a[e].classList.toggle('current',a[e]===t);e.parentNode.tfClass('tb_ui_dropdown_label')[0].textContent=n}}createItems(i,n){const e=t?'webp':'png',o=this.imgW||300,r=this.imgH||348,c='//via.placeholder.com/'+o+'x'+r+'.'+e+'?text=',d=new Set,h=m.Helper.getIcon('ti-search'),u=_.createDocumentFragment(),p=_.createDocumentFragment();for(let s=0,e=i.length;s<e;++s){let e=_.createElement('li'),t=_.createElement('div'),a=_.createElement('div'),l=new Image(o,r);if(i[s].id&&(e.dataset.id=i[s].id),i[s].slug&&(e.dataset.slug=i[s].slug),t.className='tb_layout_thumb tf_rel',l.loading='lazy',l.decoding='async',l.src=c+encodeURI(i[s].title),l.alt=l.title=i[s].title,i[s].thumbnail&&(l.dataset.src=i[s].thumbnail,g.observe(t)),a.className='tb_layout_title tf_inline_b',a.innerHTML=i[s].title,void 0!==i[s].url){let e=_.createElement('a');e.className='tb_layout_link',e.href=i[s].url,e.target='_blank',e.title=themifyBuilder.i18n.preview,e.appendChild(h.cloneNode(!0)),t.appendChild(e)}if(t.appendChild(l),i[s].category){e.dataset.category=i[s].category;let a=i[s].category.toString().split(',');for(let t=0,e=a.length;t<e;++t)if(''!==a[t]&&!d.has(a[t])){let e=_.createElement('li');e.textContent=a[t],a[t]===n&&(e.className='tb_selected_cat'),p.appendChild(e),d.add(a[t])}}e.append(t,a),u.appendChild(e)}return{items:u,cats:p}}getHtml(){const e=_.createDocumentFragment(),t=_.createElement('div'),a=_.createElement('div'),l=_.createElement('input'),s=_.createElement('span'),i=_.createElement('div'),n=_.createElement('span'),o=_.createElement('ul'),r=_.createElement('li'),c=_.createElement('ul'),d=this.createItems(this.data);return t.className='tb_layout_sticky tf_clearfix',a.className='tb-layout-search-container',l.type='text',l.placeHolder=themifyBuilder.i18n.label.search,l.className='tb_layout_search',l.required=!0,s.className='tb_clear_input tf_close',a.append(l,s),t.appendChild(a),d.cats.querySelector('li')&&(i.className='tb_ui_dropdown tf_rel',n.className='tb_ui_dropdown_label tf_rel',n.tabIndex='-1',r.textContent=n.textContent=themifyBuilder.i18n.label.all,o.className='tb_ui_dropdown_items tf_scrollbar',r.className='all',o.tfOn(h.click,e=>{'LI'===e.target.tagName&&(e.preventDefault(),e.stopPropagation(),this.clearSearch(e.target),this.filter(e.target))}).append(r,d.cats),i.append(n,o),t.appendChild(i)),l.tfOn('input',e=>{r.classList.contains('all')&&this.filter(r),this.search(e.target)},{passive:!0}),s.tfOn(h.click,e=>{e.preventDefault(),e.stopPropagation(),this.clearSearch(e.target)}),c.className='tb_layout_lists',c.dataset.group=this.id,c.appendChild(d.items),e.append(t,c),e}}d.instanes=new Map;class e extends d{constructor(){const e='predesigned';super(e),this.id=e,this.title=themifyBuilder.paths[this.id].title}getList(){const e=themifyBuilder.paths[this.id].url;return h.fetch('',null,{credentials:'omit',method:'GET',mode:'cors',headers:{'Content-Type':'application/json'}},e)}async getItem(a){const l=themifyBuilder.paths[this.id].single.replace('{SLUG}',a);try{let e=await h.fetch('',null,{credentials:'omit',method:'GET',mode:'cors',headers:{'Content-Type':'application/json'}},l),t=JSON.stringify(e);if(-1!==t.indexOf(m.GS.key)){t={builder_data:JSON.parse(t)};try{t.used_gs=await h.fetch('',null,{credentials:'omit',method:'GET',mode:'cors',headers:{'Content-Type':'application/json'}},themifyBuilder.paths[this.id].single.replace('{SLUG}',a+'-gs'))}catch(e){}}else t={builder_data:JSON.parse(t)};return t}catch(e){reject(themifyBuilder.i18n.layout_error.replace('{FILE}',l))}}}class a extends d{constructor(){super("custom"),this.id="custom",this.title=themifyBuilder.i18n.savedLayoutTitle}getList(e){return m.LocalFetch({slug:e||'',action:'tb_get_save_custom_layout'})}getItem(e){return this.getList(e).then(e=>({builder_data:e}))}}if(new e,new a,themifyBuilder.paths.theme){class l extends d{constructor(){super("theme"),this.id="theme",this.title=themifyBuilder.paths[this.id].title}getList(){const a=themifyBuilder.paths[this.id].data,l=[],s=themify_vars.theme_url+'/builder-layouts/',i=t?'.webp':'.jpg';for(let e=0,t=a.length;e<t;++e){let t=a[e].replace('.zip','');l[e]={title:(e=>{const a=t.replaceAll('-',' ').replace(/  +/g,' ').split(' ');for(let e=0,t=a.length;e<t;++e)a[e]=a[e].charAt(0).toUpperCase()+a[e].slice(1);return a.join(' ')})(),slug:t,thumbnail:s+t+i}}return Promise.resolve(l)}getItem(a){return new Promise((i,n)=>{const e=[m.Helper.loadJsZip()],t=themify_vars.theme_url+'/builder-layouts/';e.push(h.fetch('','blob',{credentials:'omit'},t+a+'.zip')),Promise.all(e).then(e=>{JSZip.loadAsync(e[1]).then(e=>{const t=e.files;if(t){const a='builder_data_export.txt',l='builder_gs_data_export.txt';if(void 0!==t[a]){const s=[];s.push(e.file(t[a].name).async('text')),void 0!==t[l]&&s.push(e.file(t[l].name).async('text')),Promise.all(s).then(e=>{const t={builder_data:JSON.parse(e[0])};e[1]&&(t.used_gs=JSON.parse(e[1])),i(t)})}else n(themifyBuilder.i18n.importBuilderNotExist)}else n(themifyBuilder.i18n.zipFileEmpty)})})})}}new l}h.trigger('tb_layout_loaded',[d,t])})(tb_app,Themify,document);