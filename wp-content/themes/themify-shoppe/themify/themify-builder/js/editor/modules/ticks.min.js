((c,h,f,u)=>{'use strict';let _,v,m,p;const y=(l,d)=>new Promise((a,r)=>{h.requestIdleCallback(async()=>{if(window.navigator.onLine){const e={action:'tb_update_tick'};l&&(e.take=1),d&&(e.count=1);try{_=new AbortController;const t=await c.LocalFetch(e,'html',{signal:_.signal});if(t){if(_.abort(),clearInterval(m),'cancel'!==t.textContent){if(!v){u.document.body.appendChild(t);const o=u.document.tfId('tmpl-tb_locked'),n=f.createElement('div'),s=c.ToolBar.el.getRootNode(),i=s.querySelector('#tf_base');n.id='tb_locked_root',n.className='tf_abs_t tf_w tf_h tf_hide',n.attachShadow({mode:'open'}).appendChild(o.content),n.shadowRoot.prepend(i.cloneNode(!0)),v=n.shadowRoot.tfId('tb_builder_restriction'),o.replaceWith(n),v.tfOn(h.click,t=>{const e=t.target?t.target.closest('.take,.rvs,.tf_close'):null;if(e){t.stopPropagation();const o=t.currentTarget.getRootNode().host,n=()=>{c.ToolBar.preventBeforeMsg=!0,'visual'===c.mode?u.location.reload():u.location.href=v.querySelector('.buttons a.btn').href};if(e.classList.contains('tf_close')){const s=!(o.style.zIndex=9999)===c.Builder.get().isSaved&&c.undoManager.hasUndo()?c.LiteLightBox.confirm({msg:themifyBuilder.i18n.builderClose,buttons:{no:themifyBuilder.i18n.label.save_no,yes:themifyBuilder.i18n.saveRevisionClose}}):Promise.resolve('no');s.then(e=>{o.style.zIndex='','yes'===e?h.triggerEvent(v.tfClass('rvs')[0],t.type):'no'===e&&n()})}else e.classList.contains('rvs')?(!0!==p&&c.Spinner.showLoader(),o.style.zIndex=9999,c.ToolBar.initRevision({target:c.ToolBar.el.tfClass('save_revision')[0]}).then(n).catch(e=>{o.style.zIndex=''}),p=!0):(o.classList.add('tf_hide'),y(!0).then(b).catch(e=>{y(!0).then(b)}))}},{passive:!0})}v.getRootNode().host.classList.remove('tf_hide')}return void a(!1)}}catch(e){return void r(e)}a()}},-1,2e3)}),b=()=>{m=setInterval(y,1e3*parseInt(themifyBuilder.ticks))};h.on('themify_builder_ready',()=>{setTimeout(()=>{y(!1,!0).then(e=>{!1!==e&&b()})},1500)},!0,c.is_builder_ready)})(tb_app,Themify,document,window.top);