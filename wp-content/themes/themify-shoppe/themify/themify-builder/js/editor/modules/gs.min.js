((g,m,e,p,v)=>{'use strict';const t=p.tfId('tb_global_styles_root').content;let n={},a;class s extends HTMLElement{init(){const e=this.shadowRoot.querySelector('.form');if(!this.done){this.done=!0;const t=Object.keys(g.GS.styles);this.addItem(t),!0!==g.GS.allLoaded&&(t.length<10&&this.loadMore(),this.list.tfOn('scroll',e=>{this.onScroll(e)},{passive:!0}),this.reLoad=this.list.tfClass('reload')[0],this.reLoad.tfOn(m.click,e=>{e.stopPropagation(),e.preventDefault(),this.loadMore()}))}this.hideShowNoGsText(),e.focus()}addItem(o){if(0<o.length){const n=p.createDocumentFragment(),a=this.field.value.split(' ');for(let i=0,e=o.length;i<e;++i)if(null===this.list.querySelector('[data-id="'+o[i]+'"]')){let e=g.GS.styles[o[i]],t=p.createElement('div'),s=p.createElement('div'),l=p.createElement('div');t.className='item',t.className+=-1!==a.indexOf(o[i])?' selected':'',t.dataset.id=o[i],l.className='title',l.innerText=e.title,s.className='type',s.innerText=e.type,t.append(l,s),n.appendChild(t)}this.list.appendChild(n),this.checkReload()}}insert(t){if(!this.selectedContainer.querySelector('[data-id="'+t+'"]')){this.createSelected(t);let e=this.field.value+' '+t;this.field.value=e=e.trim(),this.selectedContainer.closest('#container').classList.remove('empty'),g.GS.setGsStyle(e.split(' '))}}delete(e){const t=this.list.querySelector('[data-id="'+e+'"]'),s=this.selectedContainer.querySelector('[data-id="'+e+'"]');null!==t&&t.classList.remove('selected'),null!==s&&s.remove();let l=this.field.value.trim().split(' ');l.splice(l.indexOf(e),1),l=l.join(' '),''===(this.field.value=l)&&this.selectedContainer.closest('#container').classList.add('empty'),this.checkReload(),g.GS.setGsStyle(l.split(' '),!0)}createSelected(e){const t=g.GS.styles[e],s=p.createElement('div'),l=p.createElement('span'),i=p.createElement('span'),o=p.createElement('span'),n=this.list.querySelector('[data-id="'+e+'"]');s.className='selected',s.dataset.id=e,o.className='edit',o.appendChild(g.Helper.getIcon('ti-pencil')),l.className='tf_overflow',l.innerText=t.title,i.className='delete tf_close',s.append(o,l,i),n&&n.classList.add('selected'),this.selectedContainer.appendChild(s),this.checkReload()}loadMore(s){const e=this.shadowRoot.querySelector('#container').classList;if(e.contains('loading'))return Promise.reject();if(s){if(n[s]!==v)return Promise.resolve()}else s='';const t=[];for(let e in g.GS.styles)g.GS.styles[e].id!==v&&t.push(g.GS.styles[e].id);e.add('loading');const l={s:s,action:'tb_get_gs_posts',loaded:t};return a=new AbortController,g.LocalFetch(l,'json',{signal:a.signal}).then(e=>{this.hideShowNoGsText(!0),g.GS.extend(e);const t=Object.keys(e);s?n[s]=!0:(g.GS.allLoaded=t.length<10,g.GS.allLoaded&&(this.reLoad.remove(),this.reLoad=null)),this.addItem(t)}).catch(e=>{}).finally(()=>{e.remove('loading')})}onScroll(e){if(!1===g.GS.allLoaded){const t=e.target,s=Math.max(t.scrollHeight-(t.scrollTop+t.offsetHeight),0);0<s&&s<=200&&this.loadMore().catch(e=>{})}}search(){this.shadowRoot.querySelector('#search').tfOn('input',e=>{const i=e.target.value.toUpperCase().trim(),o=e.target.closest('.form').tfClass('item'),t=()=>{let l=0===o.length;for(let s=o.length-1;-1<s;--s){let t=o[s].tfClass('title')[0];if(t){let e=''===i||-1!==t.innerHTML.toUpperCase().indexOf(i)?'':'none';!1!==l||e||(l=!0),o[s].style.display=e}}this.hideShowNoGsText(l)};a&&(a.abort(),a=null),''===i||n[i]!==v||g.GS.allLoaded?t():setTimeout(()=>{this.loadMore(i).then(t).catch(e=>{})},100)},{passive:!0}),this.shadowRoot.querySelector('.clear_search').tfOn(m.click,e=>{e.stopPropagation();const t=this.shadowRoot.querySelector('#search');t.value='',t.focus(),m.triggerEvent(t,'input')},{passive:!0})}checkReload(){this.reLoad&&this.reLoad.classList.toggle('tf_hide',this.list.scrollHeight>this.list.clientHeight)}hideShowNoGsText(e){e===v&&(e=this.list.tfClass('item')[0]!==v),this.list.tfClass('no_gs')[0].classList.toggle('tf_hide',e)}saveAs(){g.LiteLightBox.prompt(themifyBuilder.i18n.enterGlobalStyleName).then(e=>{if('yes'===e[0]){const t=e[1];if(t){ThemifyConstructor.setStylingValues(g.activeBreakPoint);const s=g.Helper.clear(ThemifyConstructor.values),l=(delete s[g.GS.key],{action:'tb_save_as_new_global_style',styles:s,title:t,type:g.activeModel.get('mod_name')});g.Spinner.showLoader(),g.LocalFetch(l).then(t=>{if(g.Spinner.showLoader('hide'),'success'===t.status){const e=t.msg;t=t.post_data,g.GS.styles[t.class]=t,g.Utils.saveCss(g.Helper.clear(t.data),'',t.id).then(()=>{TF_Notification.showHide('done',e),g.LiteLightBox.confirm({msg:themifyBuilder.i18n.addSavedGS}).then(e=>{e&&('yes'===e&&ThemifyConstructor.resetStyling(g.activeModel),this.addItem([t.class]),'yes'===e&&this.insert(t.class))})})}else g.LiteLightBox.alert(t.msg)}).catch(()=>{g.Spinner.showLoader('error')})}else TF_Notification.showHide('error',themifyBuilder.i18n.enterGlobalStyleName),this.saveAs()}})}disconnectedCallback(){a&&a.abort(),this.field=this.list=a=this.selectedContainer=this.done=null}connectedCallback(){let s=ThemifyConstructor.values[g.GS.key];s;const e=t.cloneNode(!0),l=e.querySelector('#container'),i=ThemifyConstructor.hidden.render({id:g.GS.key,is_responsive:!1,value:s,control:!1},ThemifyConstructor);if(this.selectedContainer=l.tfClass('selected_wrap')[0],this.list=l.tfClass('list')[0],s){l.classList.remove('empty');let t='';for(let e=(s=s.split(' ')).length-1;-1<e;--e)g.GS.styles[s[e]]!==v&&(t+=' '+s[e],this.createSelected(s[e]));i.value=t.trim()}this.field=i,l.tfClass('actions')[0].tfOn(m.click,e=>{e.stopPropagation();const t=e.target.dataset.action;'insert'===t?this.init():'save'===t&&this.saveAs()},{passive:!0}),this.selectedContainer.tfOn(m.click,e=>{let t=e.target.closest('.selected');(t=t&&t.dataset.id)&&(e.target.closest('.delete')?this.delete(t):e.target.closest('.edit')&&g.GS.gsEdit(t))}),this.list.tfOn(m.click,e=>{const t=e.target.closest('.item');t&&this.insert(t.dataset.id)}),e.querySelector('.overlay').tfOn(m.click,function(e){e.preventDefault(),e.stopPropagation(),this.remove()},{once:!0}),this.attachShadow({mode:'open'}).appendChild(e),this.search(),this.before(i)}}customElements.define('tb-gs',s),g.GS={styles:{},allLoaded:!1,el:null,dropdown:null,field:null,activeGS:null,key:'global_styles',previousId:null,liveInstance:null,init(){m.on('tb_toolbar_loaded',()=>{const e=p.createDocumentFragment();e.appendChild(g.ToolBar.getBaseCss()),t.prepend(e.cloneNode(!0))},!0,g.ToolBar!==v&&!0===g.ToolBar.isLoaded),!0===g.isGSPage?m.on('themify_builder_ready',()=>{const e=()=>{this.openStylingPanel(),g.Registry.off(g.Builder.get(),'tb_init',e)};g.is_builder_ready?e():g.Registry.on(g.Builder.get(),'tb_init',e)},!0,g.is_builder_ready):themifyBuilder.globalStyles&&(this.extend(themifyBuilder.globalStyles),themifyBuilder.globalStyles=null)},extend(t){for(let e in t)this.styles[e]===v&&t[e]!==v&&(this.styles[e]=t[e]);return this.styles},openStylingPanel(){null===ThemifyConstructor.label&&(ThemifyConstructor.label=themifyBuilder.i18n.label);const e=themifyBuilder.globalStyleData.type;let t;switch(console.log(e),e){case'row':case'column':t='module_'+e;break;case'subrow':t='active_subrow';break;default:t='active_module';break}const s=g.Registry.get(g.Builder.get().el.tfClass(t)[0].dataset.cid);console.log(s),s.edit('styling'),g.ToolBar.previewBuilder({item:g.ToolBar.el.tfClass('preview')[0]})},setCss(e,t,s){'visual'===g.mode&&g.liveStylingInstance.setCss(e,t,s)},createCss(e,t,s){ThemifyStyles.GS={};const l=ThemifyStyles.createCss(e,t,s,this.styles,v,s);if(!0===s&&0<Object.keys(this.styles).length&&l.gs){l.gs.used='';for(let e in this.styles)l.gs.used+=''===l.gs.used?'':', ',l.gs.used+=this.styles[e].title}return l},findUsedItems(e){e=JSON.stringify(e);let t=/"global_styles":"(.*?)"/gm,s,l='';for(;null!==(s=t.exec(e));)l+=' '+s[1].trim();if(s=null,''===(l=l.trim()))return!1;{const i=[];for(let e=(l=[...new Set(l.split(' '))]).length-1;-1<e;--e)this.styles[l[e]]!==v&&i.push(l[e]);return i}},globalStylesHTML(){return!0!==g.isGSPage&&null===this.activeGS&&p.createElement('tb-gs')},updated(e,t,s,l){!1===g.isGSPage&&'visual'===g.mode&&'module'!==l.type&&this.extraStyle(e,t,s,l)},async setImport(t,e,s){if(!0!==s)for(let e in t)this.styles[e]!==v&&delete t[e];if(0<Object.keys(t).length){const l={action:'tb_import_gs_posts_ajax',data:JSON.stringify(t),onlySave:s?1:0};return g.LocalFetch(l).then(t=>{if(t)for(let e in t)this.styles[e]=t[e];return e})}return e},setGsStyle(l,i,o){if(!0!==g.isGSPage&&'visual'===g.mode){let e=(o=o||g.activeModel).get('mod_name'),t=o.id,s={styling:ThemifyStyles.generateGSstyles(l,e,this.styles),element_id:t};ThemifyStyles.disableNestedSel=!0,null===this.liveInstance&&(this.liveInstance=g.createStyleInstance(),this.liveInstance.init(!0,!0,o));const n=this.createCss([s],e),a=this.liveInstance,r=[],c=g.activeBreakPoint,d=a.prefix,h=new RegExp(d,'g');if(!(ThemifyStyles.disableNestedSel=null)===i){const f=ThemifyConstructor.breakpointsReverse;for(let t=f.length-1;-1<t;--t){g.activeBreakPoint=f[t],a.setMode(f[t],!0);let e=a.currentSheet,l=e.cssRules||e.rules;for(let e=l.length-1;-1<e;--e)if(-1!==l[e].selectorText.indexOf(d)){let t=l[e].selectorText.replace(/\,\s+/g,',').replace(h,'').split(','),s=l[e].cssText.split('{')[1].split(';');if(-1!==t[0].indexOf('.tb_text_wrap'))for(let e=t.length-1;0<e;--e)-1!==t[e].indexOf('.tb_text_wrap')&&t.splice(e,1);for(let e=s.length-2;-1<e;--e)a.setLiveStyle(s[e].trim().split(': ')[0].trim(),'',t)}}}delete n.gs;for(let o in n)if('fonts'===o||'cf_fonts'===o)for(let t in n[o]){let e=t;0<n[o][t].length&&(e+=':'+n[o][t].join(',')),r.push(e)}else{g.activeBreakPoint=o,a.setMode(o,!0);for(let s in n[o]){let i=s.replace(/\,\s+/g,',').replace(h,'').split(',');for(let e=0,t=n[o][s].length;e<t;++e){let l=n[o][s][e].split(';');for(let s=l.length-2;-1<s;--s)if(''!==l[s]){let e=l[s].split(':')[0],t=l[s].replace(e+':','').trim();'background-image'===e&&-1!==l[s].indexOf('svg')&&-1!==l[s].indexOf('data:')&&(t+=';'+l[s+1]),a.setLiveStyle(e,t,i)}}}}0<r.length&&ThemifyConstructor.font_select.loadGoogleFonts(r.join('|')),g.activeBreakPoint=c,this.updated(n,s,l,o),this.liveInstance=null}},gsEdit(e){let i;if(null!==g.activeModel)this.previousId=g.activeModel.id;else if(null!==g.ActionBar.contextMenu&&g.ActionBar.contextMenu.contains(this.field)){const l=g.Instances.Builder[g.builderIndex].el.tfClass('tb_element_clicked')[0];if(l===v)return;g.activeModel=g.Registry.get(l.dataset.cid),this.previousId=g.activeModel.id,g.Utils.scrollTo(l)}const t=this.styles[e],n=ThemifyConstructor.label.done,s=('visual'===g.mode&&g.Helper.cloneObject(g.liveStylingInstance),g.Helper.cloneObject(t.data[0])),a=t.type;this.activeGS=e,i='row'===a?(delete s.cols,delete s.styling[this.key],new g.Row(s)):'subrow'===a?(delete s.cols,delete s.styling[this.key],new g.SubRow(s)):(delete s.styling,'column'===a?(delete s.cols[0].modules,delete s.cols[0].styling[this.key],new g.Column(s.cols[0])):(delete s.cols[0].styling,delete s.cols[0].modules[0].mod_settings[this.key],new g.Module(s.cols[0].modules[0]))),console.log(i),g.LightBox.el.className+=' gs_post',ThemifyConstructor.label.done=ThemifyConstructor.label.s_s,i.edit('styling').then(s=>{console.log(s),s.tfClass('current')[0].tfClass('tb_tooltip')[0].textContent=ThemifyConstructor.label.g_s+' - '+t.title;const o=()=>{if(m.off('themify_builder_lightbox_close',o).off('themify_builder_save_component',l),s.classList.remove('gs_post'),ThemifyConstructor.label.done=n,'visual'!==g.mode&&null!==this.previousId&&('row'===a||'column'===a||'subrow'===a)){const e=g.Registry.get(this.previousId);if(e&&'module'===e.type){console.log(g.liveStylingInstance),g.liveStylingInstance.removeBgSlider(),g.liveStylingInstance.removeBgVideo(),g.liveStylingInstance.removeFrames();const t=g.liveStylingInstance.getComponentBgOverlay();t&&t.remove(),g.liveStylingInstance.el.classList.remove('builder-zoom-scrolling','builder-zooming')}}i.destroy(!0),this.reopenPreviousPanel(),this.activeGS=this.previousId=null},l=(e,t)=>{const l=this.activeGS,i=this.styles[l],s=(this.previousId,delete ThemifyConstructor.values.cid,g.Helper.cloneObject(e));g.activeModel,delete s[this.key],'row'===a||'subrow'===a?(i.data[0].styling=s,delete i.data[0].cols):(delete i.data[0].styling,delete i.data[0].cols[0].grid_class,'column'===a?(delete i.data[0].cols[0].modules,i.data[0].cols[0].styling=s):(delete i.data[0].cols[0].styling,i.data[0].cols[0].modules[0].mod_settings=s)),g.Spinner.showLoader();try{g.Utils.saveCss(i.data,'',i.id).then(()=>{if(this.styles[l].data=i.data,'visual'===g.mode){const s=g.Registry.items;for(let[e,t]of s){let e=t.get('styling');e[this.key]&&-1!==e[this.key].indexOf(l)&&this.setGsStyle(e[this.key].split(' '),!0,t)}this.liveInstance=null}const e={action:'tb_update_global_style',bid:i.id,data:i.data};g.LocalFetch(e).then(()=>{g.Spinner.showLoader('done'),o(!0)})})}catch(e){this.activeGS=this.previousId=null,g.Spinner.showLoader('error')}};m.on('themify_builder_lightbox_close',o,!0).on('themify_builder_save_component',l,!0)}).catch(e=>{console.log(e)})},reopenPreviousPanel(e){if(null!==this.previousId){const t=g.Registry.get(this.previousId);null!==t&&t.edit('styling'),this.previousId=null}},extraStyle(s,e,t,l){let i=null!==this.liveInstance?this.liveInstance:g.liveStylingInstance,o=i.prefix,n=o.length-1,a=null!==i.getComponentBgOverlay(l.type),r=i.el,c=a,d={top:!1,bottom:!1,left:!1,right:!1},h=0,f='builder-parallax-scrolling',u='builder-zoom-scrolling';e:for(let e in s)if('fonts'!==e&&'cf_fonts'!==e&&'gs'!==e)for(let t in s[e]){if(!1===c&&(c=-1!==t.indexOf('builder_row_cover',n)),-1!==t.indexOf('tb_row_frame',n))for(let e in d)if(!1===d[e]&&-1!==t.indexOf('tb_row_frame_'+e,n)){d[e]=!0,++h;break}if(!0===c&&4===h)break e}if(s=null,0==a&&!0===c&&i.addOrRemoveComponentOverlay(),0<h){let s=p.createDocumentFragment(),e=r.querySelector(':scope>.tb_row_frame_wrap');e||((e=p.createElement('div')).className='tb_row_frame_wrap tf_overflow tf_abs',r.tfClass('tb_'+l.type+'_action')[0].after(e));for(let t in d)if(!0===d[t]&&!e.tfClass('tb_row_frame_'+t)[0]){let e=p.createElement('div');e.className='tf_abs tf_overflow tf_w tb_row_frame tb_row_frame_'+t,s.appendChild(e)}e.appendChild(s)}let y=e.styling!==v?e.styling.background_type:'none';'image'===(y=y||'image')&&e.styling.background_repeat===f&&e.styling.background_image?(r.classList.add(f),m.reRun(r,!0)):(r.classList.remove(f),r.style.backgroundPosition='','image'===y&&e.styling.background_repeat===u&&e.styling.background_image?(r.classList.add(u),m.reRun(r,!0)):(r.classList.remove(u),r.style.backgroundSize=''))},reset(){this.styles={},n={},this.allLoaded=!1}},g.GS.init()})(tb_app,Themify,window.top,document,void 0);