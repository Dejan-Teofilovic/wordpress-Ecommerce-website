((u,g,f,p,b,y)=>{'use strict';u.ToolBar={isLoaded:!1,el:null,init(){if('visual'===u.mode){const r=b.document.tfId('tf_svg');if(r){const n=r.firstChild,d=n.querySelector('#tf_fonts_style'),c=f.createDocumentFragment();d&&(f.tfId('tf_fonts_style').textContent+=d.textContent,d.remove());for(let e=n.children,t=e.length-1;-1<t;--t)c.appendChild(e[t]);f.tfId('tf_svg').firstChild.appendChild(c),r.remove()}}const e=f.tfId('tb_main_toolbar_root'),t=e.firstElementChild,o=f.createElement('style'),s=f.createDocumentFragment(),i=f.tfId('tf_svg').cloneNode(!0);let l='';for(let e=u.breakpointsReverse,t=e.length-1;-1<t;--t)'desktop'!==e[t]&&(l+='--tb_bp_'+e[t]+':'+u.Utils.getBPWidth(e[t])+'px;');o.textContent=':root{'+l+'}',f.body.appendChild(o.cloneNode(!0)),y.appendChild(i.cloneNode(!0)),s.append(f.tfId('tf_lazy_common').cloneNode(!0),i.cloneNode(!0)),t&&(e.attachShadow({mode:t.getAttribute('shadowroot')}).appendChild(t.content),t.remove()),e.shadowRoot.prepend(s),'visual'===u.mode&&y.appendChild(e),this.el=e.shadowRoot.tfId('toolbar');const a=this.el.getRootNode().querySelector('#module_combine_style');'visual'===u.mode&&b.document.head.prepend(o,a.cloneNode(!0)),f.tfId('themify-builder-admin-ui-css').before(a.cloneNode(!0)),g.trigger('tb_toolbar_style_ready'),g.on('themify_builder_ready',()=>{'visual'!==u.mode&&f.tfId('tb_row_wrapper').parentNode.before(e),this.isLoaded=!0,g.trigger('tb_toolbar_loaded'),this.setModes(),e.classList.remove('tf_hide'),this.oberserveSize(),setTimeout(()=>{f.body.prepend(u.MainPanel.el.getRootNode().querySelector('#module_drag_grids_style').cloneNode(!0)),b.Themify.loadCss(g.url+'themify-metabox/css/themify.minicolors'),b.Themify.loadCss(g.builder_url+'css/editor/themify.combobox');const a={[g.click]:{'.revision_btn':'initRevision','.layout':'initLayout','.import':'initImport','.export':'initExport','.duplicate':'duplicate','.save_btn':'save','.switch':'switchTo','.tf_close':'panelClose','.breakpoint_switch':'breakpointSwitcher','.devices':'deviceSwitcher','.custom_css':'addCustomCSS','.zoom':'zoom','.preview':'previewBuilder','.tree':'initTree','.help':'initHelp','.plus':'showPanel'},change:{'.mode input':'modChange'}};for(let e in a)this.el.tfOn(e,o=>{const s=Object.keys(a[o.type]),i=o.target.closest(s);if(i)for(let e=0,t=s.length;e<t;++e)if(i.matches(s[e])){const l=a[o.type][s[e]];o.stopPropagation(),o.item=i,this[l](o);break}o=null},{passive:!0});u.Drag(u.Builder.get().el),u.Utils._updateDocumentSize(),setTimeout(()=>{this.unload(),localStorage.removeItem('tb_mode'),'visual'===u.mode&&b.Themify.on('tfsmartresize',e=>{g.trigger('tfsmartresize',e)})},2e3)},800)},!0,u.is_builder_ready)},oberserveSize(){let s;new ResizeObserver((e,t)=>{s&&cancelAnimationFrame(s);const o=e[0].target;s=requestAnimationFrame(()=>{o.classList.toggle('compact_menu',o.getBoundingClientRect().width<=800)})}).observe(this.el)},getBaseCss(){const e=f.createDocumentFragment(),t=this.el.getRootNode(),o=t.querySelector('#tf_lazy_common'),s=t.querySelector('#tf_svg'),i=t.querySelector('#tf_base');return e.append(o.cloneNode(!0),s.cloneNode(!0),i.cloneNode(!0)),e},setModes(){const e=localStorage.getItem('tb_dark_mode');('1'===e||'-1'!==e&&p.matchMedia('(prefers-color-scheme:dark)').matches)&&(this.el.tfClass('dark_mode')[0].checked=!0,this.changeDarkMode(!0)),'visual'===u.mode&&(localStorage.getItem('tb_inline_editor')&&(u.inlineEditor=!1,this.el.tfClass('inline_editor_mode')[0].checked=!1),localStorage.getItem('tb_right_click')&&(this.el.tfClass('right_click_mode')[0].checked=!1))},showPanel(){u.MainPanel.openFloat()},unload(){'visual'===u.mode&&f.head.insertAdjacentHTML('afterbegin','<base target="_parent">'),b.tfOn('beforeunload',e=>{if(!0!==this.preventBeforeMsg&&!1===u.Builder.get().isSaved&&u.undoManager.hasUndo())return e.preventDefault(),e.returnValue='Are you sure'})},panelClose(){return new Promise(t=>{const e=!1===u.Builder.get().isSaved&&u.undoManager.hasUndo()?u.LiteLightBox.confirm({msg:themifyBuilder.i18n.builderClose,buttons:{no:themifyBuilder.i18n.label.save_no,yes:themifyBuilder.i18n.saveClose}}):Promise.resolve('no');e.then(e=>{'yes'===e?this.save().then(()=>{t(e),this.panelClose()}):'no'===e&&(this.preventBeforeMsg=!0,b.location.reload())})})},async initRevision(e){const t=e.target;if(t.classList.contains('load_revision')&&u.Spinner.showLoader(),await Promise.all([g.loadJs(g.builder_url+'js/editor/modules/revisions',p.TF_Revisions),b.Themify.loadCss(g.builder_url+'css/editor/modules/revisions')]),await TB_Revisions.init(t),t.classList.contains('load_revision')){const o=t.closest('ul');o.style.display='none',setTimeout(()=>{o.style.display=''},50)}},async initLayout(e){const t=e.target;t.classList.contains('load_layout')&&u.Spinner.showLoader(),await Promise.all([g.loadJs(g.builder_url+'js/editor/modules/layouts',!!p.TB_Layouts),b.Themify.loadCss(g.builder_url+'css/editor/modules/layouts')]),await TB_Layouts.init(t)},async initImport(e){const t=e.target;t.hasAttribute('data-type')&&u.Spinner.showLoader(),await g.loadJs(g.builder_url+'js/editor/modules/import',!!p.TB_Import),await TB_Import.init(t)},async initExport(e){u.Spinner.showLoader(),await Promise.all([g.loadJs(g.builder_url+'js/editor/modules/export',!!p.TB_Export),u.Helper.loadJsZip()]),await TB_Export.init()},async initHelp(){u.Spinner.showLoader(),await g.loadJs(g.builder_url+'js/editor/modules/help',!!p.TB_Help),await TB_Help.init()},initTree(e){const t=e.target.closest('.tree');t.classList.contains('active')?u.Tree.close():u.Tree.open()},async duplicate(e){const t=await u.LiteLightBox.confirm({msg:themifyBuilder.i18n.confirm_on_duplicate_page});try{if('yes'===t&&await u.Builder.get().save(),t){u.Spinner.showLoader('show');const o=await u.LocalFetch({action:'tb_duplicate_page',tb_is_admin:'visual'!==u.mode?1:0});let e=o.data;if(!o.success)throw e;'visual'===u.mode&&(e+='#builder_active'),await u.Spinner.showLoader('done'),b.location.href=e.replaceAll('&amp;','&')}}catch(e){u.Spinner.showLoader('error'),TF_Notification.showHide('error',e,4e3)}},modChange(e){const t=e.item.classList,o=!0===e.item.checked;if(t.contains('right_click_mode'))o?localStorage.removeItem('tb_right_click'):localStorage.setItem('tb_right_click',1),u.RightClick&&u.RightClick.bind();else if(t.contains('padding_dragging_mode'))o?localStorage.removeItem('tb_disable_padding_dragging'):localStorage.setItem('tb_disable_padding_dragging',1),u.EdgeDrag.init();else if(t.contains('dark_mode')){localStorage.setItem('tb_dark_mode',o?1:-1),this.changeDarkMode(o);const s=y.querySelectorAll('.tf_cdm textarea');for(let e=s.length-1;-1<e;--e)s[e].tf_mirror&&s[e].tf_mirror.setDarkMode(o)}else t.contains('inline_editor_mode')&&(o?localStorage.removeItem('tb_inline_editor'):localStorage.setItem('tb_inline_editor',1),u.inlineEditor=o,g.trigger('tb_inline_editor_changed'))},changeDarkMode(e){const t=f.getElementById('tb_dark_mode_style'),o='visual'===u.mode?b.document.getElementById('tb_dark_mode_style'):null;if(e){const s=f.tfId('themify-builder-admin-ui-css');g.loadCss(g.builder_url+'css/editor/darkmode-ui','tb_dark_mode_style',null,s.nextSibling),'visual'===u.mode&&b.Themify.loadCss(g.builder_url+'css/editor/darkmode-ui','tb_dark_mode_style',null,b.document.querySelector('link[href*="/modules/lightbox."]').nextSibling)}t&&(t.disabled=!e),o&&(o.disabled=!e),u.isDarked=e},switchTo(e){const t=e.item.getAttribute('href');'visual'!==u.mode?g.trigger('tb_switch_frontend',[t]):this.save().then(()=>{b.location.href=t})},save(){return new Promise(async(e,t)=>{try{u.LayoutPart&&u.LayoutPart.item&&(await u.LayoutPart.item.save(),await u.LayoutPart.item.close()),await u.Builder.get().save(),e()}catch(e){t(e)}})},zoom(d){return new Promise(o=>{if('visual'===u.mode&&'desktop'===u.activeBreakPoint){const s=d.item;let t=s.dataset.zoom.toString()||'100',e='';const i=y.tfClass('tb_iframe')[0],l=s.closest('.zoom_menu'),a=l.querySelectorAll('.submenu .zoom'),r=l.tfClass('zoom_toggle')[0].parentNode;if(s.classList.contains('zoom_toggle')&&(t=u.zoomMeta||'100'!==t?'100':'50'),u.zoomMeta===t||'100'===t&&!u.zoomMeta)o();else{for(let e=a.length-1;-1<e;--e)a[e].parentNode.classList.toggle('selected_zoom','100'!==t&&a[e].dataset.zoom===t);if(i.tfOn('transitionend',()=>{u.Utils._onResize(!0),o()},{passive:!0,once:!0}),u.zoomMeta=!1,'100'!==t){const n='50'===t?2:1.25;i.parentNode.classList.add('tb_zoom_bg'),e=Math.max(b.innerHeight*n,600)+'px',u.zoomMeta=t}r.classList.toggle('selected_zoom',u.zoomMeta),f.body.classList.toggle('tb_zoom_only',u.zoomMeta),i.parentNode.style.height=e,i.classList.remove('tb_zooming_50','tb_zooming_75'),'100'!==t&&i.classList.add('tb_zooming_'+t)}}else o()})},async addCustomCSS(s){try{await u.LightBox.save();const n={contructor:!0,loadMethod:'html',save:{},data:{css:{options:[{id:'custom_css',type:'textarea',rows:17,class:'fullwidth'},{id:'custom_css_m',type:'message',label:'',comment:ThemifyConstructor.label.cus_css_m},{id:'postid',type:'hidden',value:u.Builder.get().id}]}}},d=s.target.closest('.custom_css'),c=d.getBoundingClientRect();d.classList.add('active'),u.LightBox.el.classList.add('tb_custom_css_lightbox');let e=await u.LightBox.setStandAlone(c.left,c.top).open(n),i=e.querySelector('#custom_css'),t=e.tfClass('builder_save_button')[0],l=u.Builder.get(),a='tb_custom_css_'+l.id,r,o=async e=>{e&&(e.stopImmediatePropagation(),e.preventDefault()),r.save();const t=i.value.trim()||'',o=f.tfId(a),s=b.CodeMirror.lint.css(t,{errors:1});s&&0<s.length&&await TF_Notification.showHide('error',themifyBuilder.i18n.broken_code.replace('%s','CSS'),4e3),o&&(o.innerHTML=t),l.customCss=t,u.LightBox.close()};i.value=l.customCss||'',(r=await u.Helper.codeMirror(i,'css',{autofocus:!0})).editor.on('change',e=>{const t=e.getValue().trim();if('visual'===u.mode){let e=f.tfId(a);null===e&&((e=f.createElement('style')).id=a,f.head.appendChild(e)),e.innerHTML=t}}),t.tfOn(g.click,o,{once:!0}),g.on('tb_save_lb',o),g.on('themify_builder_lightbox_close',()=>{e.classList.remove('tb_custom_css_lightbox'),t.tfOff(g.click,o,{once:!0}),g.off('tb_save_lb',o),d.classList.remove('active'),r.destroy(),i=t=r=null},!0)}catch(s){}},previewBuilder(e){const t=e.item,o=u.Builder.get().el;if(t.classList.toggle('active'),u.isPreview=!u.isPreview,u.isPreview||'visual'!==u.mode||(b.document.tfId('tb_iframe').style.height=''),f.body.classList.toggle('tb_preview_only'),f.body.classList.toggle('themify_builder_active'),y.classList.toggle('tb_preview_only'),u.ToolBar.el.classList.toggle('tb_preview_only'),u.MainPanel.el.classList.toggle('tb_preview_only'),u.isPreview){const s=o.tfClass('row_inner');for(let o=s.length-1;-1<o;--o)if(1===s[o].childElementCount&&void 0===s[o].tfClass('active_module')[0]){let t=s[o].tfClass('module_column')[0];if(void 0!==t){let e=u.Registry.get(t.dataset.cid);if(e&&0===Object.keys(e.get('styling')).length){let e=s[o].closest('.module_row'),t=u.Registry.get(e.dataset.cid);t&&0===Object.keys(t.get('styling')).length&&e.classList.add('tf_hide')}}}}else{const i=o.querySelectorAll('.tf_hide.module_row');for(let e=i.length-1;-1<e;--e)i[e].classList.remove('tf_hide')}if('visual'===u.mode){const l=o.querySelectorAll('[data-cid]');for(let e=l.length-1;-1<e;--e)u.Registry.trigger(l[e].dataset.cid,'preview')}},deviceSwitcher(e){const t=e.target,o=t.dataset.width,s=t.dataset.height;if(o){const i=this.el.tfClass('selected_device')[0];return i&&i.classList.remove('selected_device'),t.classList.add('selected_device'),this.switchToBreakpoint(+o,+s)}return Promise.reject()},breakpointSwitcher(e){let t='desktop',o;if('string'==typeof e)t=e;else{const s=e.item;s.classList.contains('breakpoint-tablet')?t='tablet':s.classList.contains('breakpoint-tablet_landscape')?t='tablet_landscape':s.classList.contains('breakpoint-mobile')&&(t='mobile')}if(u.activeBreakPoint!==t)return o='desktop'!==t?u.Utils.getBPWidth(t)-1:'',this.switchToBreakpoint(o,'')},iframeScroll(){this.scrollY!==p.scrollY&&p.scroll(0,this.scrollY),this.scrollY!==b.scrollY&&b.scroll(0,this.scrollY)},switchToBreakpoint(_,h){return new Promise(d=>{if(!y.classList.contains('tb_start_change_mode')){let s='desktop',o=u.activeBreakPoint,i=b.document.tfId('tb_iframe');if(_){_*=1;const c=themifyBuilder.breakpoints;for(let e in c)if(Array.isArray(c[e])){if(c[e][0]<=_&&_<=c[e][1]){s=e;break}}else if(_<=c[e]){s=e;break}if(!1!==u.isDocked&&'tablet_landscape'===s){const m=y.tfClass('tb_workspace_container').offsetWidth;m<_&&(_=m)}_+='px'}else _='';if(0<h?h+='px':h='',null!==i&&_===i.style.width&&h===i.style.height)return d(),!1;if(u.ActionBar.disable=!0,null!==i){let e=''!==_?'width':'';''!==h&&(e+=''!==h&&''!==e?',height':''),i.style.willChange=e,u.ActionBar.clear()}let l=[f.body.classList,y.classList,this.el.classList,u.MainPanel.el.classList,u.SmallPanel.el.classList],a=[],e,r=null!==i&&i.classList.contains('tb_resizing_start'),n=()=>{if('visual'===u.mode){for(let e=a.length-1;-1<e;--e)a[e].style.display='',a[e].getAttribute('style')||a[e].removeAttribute('style');f.body.classList.toggle('tf_scrollbar','desktop'!==s)}for(let e=l.length-1;-1<e;--e)l[e].remove('builder-breakpoint-'+o),l[e].toggle('tb_responsive_mode','desktop'!==s),l[e].add('builder-breakpoint-'+s);const t=()=>{g.trigger('themify_builder_change_mode',[o,s]),u.scrollTo=u.ActionBar.disable=l=e=i=a=r=o=s=null};if('visual'===u.mode){i.style.willChange='','desktop'===s&&(y.style.height=''),b.tfOff('scroll',this.iframeScroll,{passive:!0}),p.tfOff('scroll',this.iframeScroll,{passive:!0}),'desktop'!==s&&(b.tfOn('scroll',this.iframeScroll,{passive:!0}),p.tfOn('scroll',this.iframeScroll,{passive:!0})),!u.scrollTo&&e&&(u.scrollTo=e),u.Utils.scrollTo(u.scrollTo);for(let e=l.length-1;-1<e;--e)l[e].remove('tb_start_animate');null!==i&&(i.style.transition=''),setTimeout(()=>{u.Utils._onResize(!0).then(()=>{if(u.Utils.setCompactMode(f.tfClass('module_column')),'desktop'===s){const e=this.el.tfClass('selected_device')[0];e&&e.classList.remove('selected_device')}u.Utils.scrollTo(u.scrollTo),b.scroll(0,p.scrollY);for(let e=l.length-1;-1<e;--e)l[e].remove('tb_start_change_mode');t(),d()})},150)}else t(),d()},t=u.zoomMeta&&'100'!=u.zoomMeta?this.zoom({item:this.el.tfClass('zoom_toggle')[0]}):Promise.resolve();t.then(()=>{if(u.activeBreakPoint=s,'visual'===u.mode){e=u.liveStylingInstance.el||f.elementFromPoint(g.w/2-20,this.el.offsetHeight);const t=u.Builder.get().el.children,o=e=>{if(null!=e){const t=e.getBoundingClientRect();(t.bottom<0&&t.top<0||t.top>g.h)&&(e.style.display='none',a.push(e))}};for(let e=t.length-1;-1<e;--e)o(t[e]);o(f.tfId('headerwrap')),o(f.tfId('footerwrap'));for(let e=l.length-1;-1<e;--e)l[e].add('tb_start_animate','tb_start_change_mode');setTimeout(()=>{r?n():(i.tfOn('transitionend',n,{passive:!0,once:!0}).style.height=h,i.style.width=_)},50)}else n()})}})}},u.ToolBar.init()})(tb_app,Themify,document,window,window.top,window.top.document.body);