((s,l)=>{'use strict';const n=new Map;s.Library=class{constructor(e){if(this.el=e,s.Library.items)this.init();else{const t={action:'tb_get_library_items',part:'all'};s.LocalFetch(t).then(e=>{s.Library.items=e,this.init()}).catch(e=>{s.Spinner.showLoader('error'),this.el.innerHTML='<h3>Failed to load Library Items.</h3>'})}}init(){const e=this.el.tfClass('tf_loader')[0];this.el.tfOn(Themify.click,this.remove.bind(this)),e&&e.remove(),this.el.appendChild(s.Library.create(s.Library.items)),Themify.triggerEvent(this.el.previousElementSibling.tfClass('current')[0],Themify.click)}remove(a){if(a.target.closest('.remove_item_btn')){a.preventDefault(),a.stopPropagation();let r=a.target.closest('.library_item'),o=r.dataset.type;s.LiteLightBox.confirm({msg:themifyBuilder.i18n[o+'LibraryDeleteConfirm']}).then(e=>{if('yes'===e){const i=r.dataset.slug.toString(),t={action:'tb_remove_library_item',id:i};s.Spinner.showLoader(),s.LocalFetch(t,'text').then(e=>{if(s.Spinner.showLoader('done'),e){const n=[s.MainPanel.el,s.SmallPanel.el];for(let r=n.length-1;-1<r;--r){let e=n[r].querySelector('.tb_item_'+o+'[data-slug="'+i+'"]'),t=n[r].querySelector('.library_tab .current');e&&(e.remove(),t&&Themify.triggerEvent(t,a.type))}if('part'===o){const r=l.tfClass('themify_builder_content-'+i),t=ThemifyConstructor.layoutPart.data;for(let t=r.length-1;-1<t;--t){let e=r[t].closest('.active_module');(e||r[t]).remove()}for(let e=t.length-1;-1<e;--e)if(t[e].id.toString()===i){ThemifyConstructor.layoutPart.data.splice(e,1);break}}}else s.Spinner.showLoader('error')}).catch(e=>{s.Spinner.showLoader('error')})}})}}},s.Library.create=i=>{const o=l.createDocumentFragment(),e=l.createElement('span');e.className='tb_no_content tf_hide',e.textContent='No library content found.',o.appendChild(e);for(let n=0,e=i.length;n<e;++n){let e='part',t=l.createElement('div'),r=l.createElement('button');-1!==i[n].post_type.indexOf('_rows',5)?e='row':-1!==i[n].post_type.indexOf('_module',5)&&(e='module'),t.className='library_item tf_rel tf_box tb_item_'+e,t.draggable=!0,t.dataset.type=e,t.dataset.slug=i[n].id,t.textContent=i[n].post_title,r.type='button',r.className='add_module_btn remove_item_btn tb_disable_sorting tf_close',t.appendChild(r),o.appendChild(t)}return o},s.Library.get=async(t,e)=>{if(n.has(t))return n.get(t);{const r={action:'tb_get_library_item',type:e,id:t};return s.Spinner.showLoader(),s.LocalFetch(r).then(e=>{if(e.content.gs&&(s.GS.styles=ThemifyStyles.extend(!0,{},e.content.gs,s.GS.styles),delete e.content.gs),'success'===e.status)return s.Spinner.showLoader('done'),n.set(t,e.content),e.content;s.Spinner.showLoader('error')}).catch(()=>{s.Spinner.showLoader('error')})}}})(tb_app,document);