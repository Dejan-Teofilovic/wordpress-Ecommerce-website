((_,d,u,o,g)=>{'use strict';const i=u.tfId('tmpl-builder_row_action').content,a=u.tfId('tmpl-builder_column_action').content,n=u.tfId('tmpl-builder_subrow_action').content,c=u.tfId('tmpl-builder_module_action').content;class t extends HTMLElement{connectedCallback(){const t=this.constructor.template.cloneNode(!0),e=t.querySelector('.dropdown'),r=(s,t)=>{let e=s.getRootNode(),l=s.dataset.href;'options'===l&&(e.querySelector('#'+l).classList.add('selected'),l=null!==(l=e.querySelector('.row_menu .selected'))?l.dataset.href:'grid');const o=e.querySelector('#'+l),i=e.querySelector('#grid'),a=e.host.closest('[data-cid]').dataset.cid,n='grid'===l?e.querySelector('#row_options'):i,c=e.querySelector('#options');o.childElementCount<2&&('grid'===l?_.Registry.trigger(a,'gridMenu',i):_.Registry.trigger(a,'optionsTab',o));for(let t=s.parentNode.children,e=t.length-1;-1<e;--e)t[e].classList.toggle('selected',t[e]===s);o.classList.add('selected'),null!==n&&n.classList.remove('selected'),'click'!==t&&null!==c&&_.Utils.addViewPortClass(c)};e.tfOn('pointerover',function(t){t.stopPropagation();const e=this.getRootNode(),s=u.body.classList,l=t.target,o=l.classList.contains('more')||l.classList.contains('inner_more')?l.tfClass('menu')[0]:null;if(this.classList.contains('module')&&e.host.closest('.active_module').classList.add('tb_active_action_bar'),(o||l.classList.contains('inner_more')||l.classList.contains('menu'))&&_.Utils.addViewPortClass(o||l),l.hasAttribute('data-href'))r(l);else{const i=e.querySelector('.tab');if(null!==i){for(let t=this.children,e=t.length-1;-1<e;--e)t[e].classList.remove('selected');i.classList.remove('selected')}}s.contains('tb_action_bar_hover')||(s.add('tb_action_bar_hover'),this.tfOn('pointerleave',t=>{s.remove('tb_action_bar_hover')},{passive:!0,once:!0}))},{passive:!0}),this.attachShadow({mode:'open'}).appendChild(t),this.shadowRoot.tfOn(d.click,function(s){s.stopPropagation();const l=s.target.closest('[data-action]');if(l){let t=_.Registry.get(this.host.closest('[data-cid]').dataset.cid),e=l.dataset.action;if('edit'===e||'styling'===e||'visibility'===e||'swap'===e){if('edit'===e&&'module'===t.type){const o=this.querySelector('.swap');o&&null!==o.offsetParent&&(e='editBuilder')}t.edit(e)}else if('add_col'===e){const i=t.el,a=new _.Column({},'subrow'===t.type);_.undoManager.start('move'),_.Drop.column(a.el,i,'right').then(()=>{_.undoManager.end('move')})}else if('up'===e||'down'===e){const n='up'===e?t.el.previousElementSibling:t.el.nextElementSibling,c=parseInt(getComputedStyle(u.querySelector(':root')).getPropertyValue('--tb_toolbar_h'));_.ActionBar.clear(),t.el.classList.add('tb_draggable_item'),_.undoManager.start('move'),'up'===e?n.before(t.el):n.after(t.el),d.trigger('tb_'+t.type+'_sort',[t.el]),_.undoManager.end('move'),t.el.classList.remove('tb_draggable_item'),_.Utils.scrollTo(t.el,c,{behavior:'smooth'})}else t.trigger(e,'paste'===e?s.target.classList.contains('style'):s.target)}else s.target.hasAttribute('data-href')&&r(s.target,'click')},{passive:!0})}disconnectedCallback(){u.body.classList.remove('tb_action_bar_hover')}}class e extends t{}class s extends t{}class l extends t{}class r extends t{}e.template=i,s.template=a,l.template=n,r.template=c,customElements.define('tb-row-bar',e),customElements.define('tb-column-bar',s),customElements.define('tb-subrow-bar',l),customElements.define('tb-module-bar',r),_.ActionBar={cid:null,disable:null,breadCrumbs:null,disablePosition:null,init(){const t=c.querySelector('style'),e=u.createDocumentFragment(),s=i.querySelector('#module_row_grids_style'),l=i.querySelector('#module_form_fields_style');e.appendChild(_.ToolBar.getBaseCss()),c.prepend(e.cloneNode(!0)),e.appendChild(t.cloneNode(!0)),i.prepend(e.cloneNode(!0)),a.prepend(e.cloneNode(!0)),e.appendChild(l.cloneNode(!0)),n.prepend(e,s.cloneNode(!0)),'visual'===_.mode?o.document.head.prepend(l.cloneNode(!0)):o.document.head.appendChild(l.cloneNode(!0)),!0!==_.isGSPage&&(this.breadCrumbs=u.createElement('ul'),this.breadCrumbs.className='tb_action_breadcrumb',d.on('themify_builder_ready',()=>{const e=_.Builder.get().el;if(e.tfOn(d.click,s=>{const t=s.target;if(_.isDocked&&t.classList.contains('tb_dragger'))s.preventDefault(),s.stopPropagation(),_.EdgeDrag.openLightBox(t);else if(t.closest('.tb_visibility_hint,.tb_row_info')){const e=_.Registry.get(t.closest('[data-cid]').dataset.cid);t.closest('.tb_visibility_hint')?e.edit('visibility'):e.edit().then(t=>{const e=t.querySelector('.tb_field_group_css .tb_style_toggle.tb_closed');e&&d.triggerEvent(e,s.type)}).catch(()=>{})}else this.click(s)}).tfOn('pointerover',t=>{t.stopPropagation(),this.hover(t)},{passive:!0}),!d.isTouch&&(e.tfOn('pointerleave',t=>{t.relatedTarget&&t.relatedTarget===e.ownerDocument.body||this.clear()},{passive:!0}).tfOn('dblclick',t=>{if('DIV'===t.target.tagName&&t.target.classList.contains('tb_dragger'))_.EdgeDrag.openLightBox(t.target);else if(!_.isDocked){const e=t.target.closest('[data-cid]');if(e){t.preventDefault();const s=_.Registry.get(e.dataset.cid),l=s.el.tfTag('tb-'+s.type+'-bar')[0];if(!0!==s.isEmpty)if(l){const o=l.shadowRoot.querySelector('.edit');o&&d.triggerEvent(o,d.click)}else this.click(t)}}}),!themifyBuilder.disableShortcuts)){const t='visual'===_.mode?null:u.tfId('tb_canvas_block');null===t?(u.tfOn('keydown',t=>{this.actions(t)}),o.document.tfOn('keydown',t=>{this.actions(t)})):t.tfOn('keydown',t=>{this.actions(t)})}},!0,_.is_builder_ready))},actions(e){const t=e.target,s=t.tagName;if(!('INPUT'===s||'TEXTAREA'===s||u.activeElement.isContentEditable||_.LightBox.el.contains(t)||'visual'===_.mode&&_.liveStylingInstance&&_.liveStylingInstance.el&&_.liveStylingInstance.el.contains(u.activeElement))){const i=e.code,a=_.Builder.get().el.tfClass('tb_element_clicked');let t=a.length;if(0<t){let l=e.action,o=!0;if(l||('Delete'===i?l='delete':!0!==e.ctrlKey&&!0!==e.metaKey||('KeyC'===i?l='copy':'KeyD'===i?l='duplicate':'KeyV'===i&&(l='paste'))),l){'copy'===l?t=1:'paste'===l&&(o=!0===e.shiftKey),'function'==typeof e.preventDefault&&(e.preventDefault(),e.stopPropagation());const n=()=>{const s=[];_.undoManager.start(l);for(let e=t-1;-1<e;--e){let t=a[e].closest('[data-cid]');null!==t&&s.push(_.Registry.trigger(t.dataset.cid,l,o,!0))}'delete'===l&&this.clear(),Promise.all(s).finally(()=>{_.undoManager.end(l)})};'delete'===l||'paste'===l?_.LightBox.save().then(n).catch(t=>{}):n()}}}},columnHover(t){let o=t.closest('.sub_column'),e=_.Builder.get().el,s=e.tfClass('tb_action_overlap'),l=(null===o?t:o.parentNode).closest('.module_column');for(let t=s.length-1;-1<t;--t)s[t].classList.remove('tb_action_overlap');for(let t=(s=e.tfClass('tb_active_action_bar')).length-1;-1<t;--t)s[t].classList.remove('tb_active_action_bar');for(let t=(s=e.querySelectorAll('.tb_hide_drag_left,.tb_hide_drag_right')).length-1;-1<t;--t)s[t].classList.remove('tb_hide_drag_left','tb_hide_drag_right');if(null!==l||null!==o){const i=[l,o];for(let e=i.length-1;-1<e;--e)if(null!==i[e]){let t=i[e].offsetLeft;0===t&&i[e].classList.add('tb_hide_drag_left'),t+i[e].offsetWidth>=i[e].parentNode.offsetWidth&&i[e].classList.add('tb_hide_drag_right')}if(null!==o){const a=o.tfClass('tb_column_action')[0];if(a!==g){let t=a.getBoundingClientRect(),e=!0,s=o.parentNode.closest('.module_column'),l=(t.left<5?s.closest('.module_row').tfClass('tb_row_action'):o.closest('.module_subrow').tfClass('tb_subrow_action'))[0];if(l!==g){const n=l.getBoundingClientRect();e=!(Math.abs(t.left-n.left)<t.width)||Math.abs(n.top-t.top)>t.height}a.classList.toggle('tb_action_overlap',!1===e)}}}if(!0!==this.isFullWidth){const c=(null!==o?o.parentNode:t).closest('.module_column');if(!1!==this.isFullWidth){const r=(null!==c?c:t).closest('.module_row');null!==r&&(this.isFullWidth=r.offsetWidth<document.body.clientWidth,document.body.classList.toggle('tb_page_row_fullwidth',!this.isFullWidth))}if(null!==c&&null!==c.parentNode.parentNode.closest('.fullwidth')){const d=c.tfClass('tb_column_action')[0];d!==g&&d.getBoundingClientRect().right>=document.body.clientWidth&&d.classList.add('tb_action_outside')}}},hover(t){if(!u.body.classList.contains('tb_start_animate')&&null===this.disable&&'tb_small_toolbar_root'!==t.target.id&&(this.columnHover(t.target),null===this.disablePosition)){const e=t.target.closest('[data-cid]');if(null===e||e.classList.contains('tb_active_layout_part'))this.clear();else{const s=e.dataset.cid;if(this.cid!==s){this.clear();const l=_.Registry.get(s),o='module'===l.type?e.tfClass('tb_'+l.type+'_action')[0]:t.target.classList.contains('tb_action_wrap')?t.target:g;if(o!==g){this.cid=s;let t=l.get('mod_name');'row'===t&&l.el.classList.contains('tb-page-break')&&(o.className+=' tb_move',t='page_break');const i=u.createElement('tb-'+l.type+'-bar');if(i.className='tb_bar_'+t,!0===l.isEmpty)i.className=' tb_disabled_module';else if(!0===l.isSubCol)i.className+=' tb_bar_sub_column';else if('row'===t){const a=e.parentNode;2<a.childElementCount?e===a.firstElementChild?i.className+=' tb_row_first':e===a.lastElementChild.previousElementSibling&&(i.className+=' tb_row_last'):i.className+=' tb_row_first tb_row_last'}if('desktop'!==_.activeBreakPoint&&(i.className+=' tb_bar_responsive_mode'),o.style.marginTop='',o.id='tb_component_bar',o.appendChild(i),'module'===l.type){let t=e.getBoundingClientRect();if(t.height<70||t.width<200){const n=i.shadowRoot.querySelector('.wrap,.dropdown').classList,c=(n.remove('small_top','small_bottom'),o.getBoundingClientRect().top);if(c<40||c-_.Builder.get().el.getBoundingClientRect().top<40?n.add('small_top'):n.add('small_bottom'),n.toggle('small_height',t.height<70),n.toggle('small_width',t.width<200),t.width<200){const r=i.shadowRoot.querySelector('.dropdown');r.children[parseInt(r.childElementCount/2)].after(r.tfClass('edit')[0])}}}o.classList.add('tb_clicked')}'visual'===_.mode&&_.EdgeDrag.addEdges(l)}}}},click(t){if(_.isPreview||!0===this.disable||null!==t.target.closest('.tb_disable_sorting,.tb_grid_drag'))return!0;const e=t.target,s=e.closest('[data-cid]');if(s&&-1===e.tagName.indexOf('-')){t.preventDefault();const l=_.Registry.get(s.dataset.cid);l&&!0!==l.isEmpty&&(!0===t.ctrlKey||!0===t.metaKey?s.classList.add('tb_element_clicked'):(this.clearClicked(),'dblclick'!==t.type&&!_.isDocked||s.classList.contains('tb_active_layout_part')||l.edit()))}},clear(){const e=_.Builder.get().el.querySelectorAll('#tb_component_bar');for(let t=e.length-1;-1<t;--t){for(e[t].style.display='none';null!==e[t].firstChild;)e[t].lastChild.remove();e[t].removeAttribute('id'),e[t].classList.remove('tb_active_action_bar'),e[t].style.display=''}this.cid=null},clearClicked(){const e=_.Builder.get().el.tfClass('tb_element_clicked');for(let t=e.length-1;-1<t;--t)e[t].classList.remove('tb_element_clicked')}},d.on('tb_toolbar_loaded',()=>{_.ActionBar.init()},!0,_.ToolBar!==g&&!0===_.ToolBar.isLoaded)})(tb_app,Themify,document,window.top,void 0);