((c,r,h)=>{'use strict';const e=t=>{c.RightClick.show(t)},s=t=>{const e=c.RightClick;1!==t.which||e.el.contains(t.target)||t.target===e.el.getRootNode().host||e.hide()},i=t=>{c.RightClick.clickEvent(t)},l=t=>{c.RightClick.hoverEvent(t)};c.RightClick={init(){const t=h.tfId('tb_builder_right_click_root'),e=t.firstElementChild,s=(e&&(t.attachShadow({mode:e.getAttribute('shadowroot')}).appendChild(e.content),e.remove()),this.el=t.shadowRoot.tfId('menu'),new Promise(e=>{r.on('tb_toolbar_loaded',()=>{c.ToolBar.el.getRootNode();const t=h.createDocumentFragment();t.append(c.ToolBar.getBaseCss(),c.LightBox.el.querySelector('#module_breadcrumbs_style').cloneNode(!0)),this.el.getRootNode().prepend(t),e()},!0,void 0!==c.ToolBar&&!0===c.ToolBar.isLoaded)}));Promise.all([r.loadCss(r.builder_url+'css/editor/modules/right-click',null,null,this.el),s]).then(()=>{this.bind()})},bind(){r.on('themify_builder_ready',()=>{const t=c.Builder.get(0).el;localStorage.getItem('tb_right_click')?(this.hide(),t.tfOff('contextmenu',e),h.tfOff('pointerdown',s,{passive:!0}),'visual'===c.mode&&window.top.document.tfOff('pointerdown',s,{passive:!0}),this.el.tfOff(r.click,i).tfOff('pointerover',l,{passive:!0})):(t.tfOn('contextmenu',e),h.tfOn('pointerdown',s,{passive:!0}),'visual'===c.mode&&window.top.document.tfOn('pointerdown',s,{passive:!0}),this.el.tfOn(r.click,i).tfOn('pointerover',l,{passive:!0}))},!0,c.is_builder_ready)},show(i){const l=i.target.closest('[data-cid]');if(!l||c.isPreview||'visual'===c.mode&&h.activeElement.contentEditable&&c.liveStylingInstance.el&&c.liveStylingInstance.el.contains(h.activeElement))this.hide();else{const o=c.Registry.get(l.dataset.cid);if(!0!==o.isEmpty){i.stopImmediatePropagation(),i.preventDefault(),this.el.getRootNode().host.classList.remove('tf_hide'),h.body.classList.add('tb_right_click_open');let t=i.pageX,e=i.pageY,s;const n=o.type,a=window.scrollY,d=this.el.tfClass('name')[0];if(this.el.className='tf_abs_t tf_hidden '+n,c.undoManager.hasUndo()||this.el.classList.add('undo_disabled'),c.undoManager.hasRedo()||this.el.classList.add('redo_disabled'),'column'===n?this.el.classList.add('visibility_disabled'):'module'===n&&this.el.classList.add('tb_module_'+o.get('mod_name')),!0===i.ctrlKey||!0===i.metaKey)l.classList.add('tb_element_clicked');else if(!l.classList.contains('tb_element_clicked')){for(let t=(s=c.Builder.get().el.tfClass('tb_element_clicked')).length-1;-1<t;--t)s[t].classList.remove('tb_element_clicked');l.classList.add('tb_element_clicked')}1<(s=c.Builder.get().el.tfClass('tb_element_clicked').length)?(this.el.classList.add('is_multiply'),d.textContent=themifyBuilder.i18n.multiSelected,this.el.tfClass('tb_action_breadcrumb')[0].innerHTML=''):(d.textContent='module'===n?o.getName():n,o.setBreadCrumbs(this.el)),t<0?t=0:t+this.el.offsetWidth>h.documentElement.offsetWidth&&(t=h.documentElement.offsetWidth-this.el.offsetWidth-5),e<0?e=0:e<a?e=a+5:e+this.el.offsetHeight+5>a+r.h&&(e=a+r.h-this.el.offsetHeight-c.ToolBar.el.offsetHeight-5),this.el.style.transform='translate('+t+'px,'+e+'px)',this.el.classList.add('tb_show_context')}}},hide(){const t=this.el.getRootNode(),e=t.querySelector('#global_styles'),s=(t.host.classList.add('tf_hide'),this.el.style.transform='',t.querySelector('.inline_gs'));s&&s.remove(),e&&e.remove(),h.body.classList.remove('tb_right_click_open')},clickEvent(t){t.stopPropagation(),t.preventDefault();const e=t.target.closest('.tb_bread');if(e){const s=c.Registry.get(e.dataset.id);r.triggerEvent(s.el,'contextmenu',null,!0)}else{const i=t.target.closest('[data-action]');if(i){i.classList.contains('not_multi');const l=i.dataset.action;if('undo'===l||'redo'===l)c.undoManager.changes('undo'===l);else{const o=c.Builder.get().el.tfClass('tb_element_clicked');if('gs_in'===l||'gs_r'===l){if('gs_in'===l){const n=h.createElement('tb-gs'),a=this.el.style.transform;return n.className='inline_gs tf_abs_t',n.style.transform=a+' scale(0)',this.el.after(n),n.init(),void(this.el.tfOn('transitionend',t=>{n.style.transform=a+' scale(1)'},{passive:!0,once:!0}).style.transform=a+' scale(0)')}}else{const d=c.Registry.get(o[0].dataset.cid);if(d)if('reset'===l){c.undoManager.start('resetStyling');for(let e=o.length-1;-1<e;--e){let t=c.Registry.get(o[e].dataset.cid);t&&ThemifyConstructor.resetStyling(t)}c.undoManager.end('resetStyling')}else'save'===l?d.save(this.el.getBoundingClientRect()):'edit'===l||'styling'===l||'visibility'===l?d.edit(l):c.ActionBar.actions({action:l,target:this.el,shiftKey:i.classList.contains('style')})}}this.hide()}}},hoverEvent(t){if(t.stopPropagation(),t.target.classList.contains('inner_more')){const e=t.target.tfTag('ul')[0];e&&c.Utils.addViewPortClass(e)}}},c.RightClick.init()})(tb_app,Themify,document);