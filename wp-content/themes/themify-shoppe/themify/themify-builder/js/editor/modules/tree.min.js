((h,s,c,i)=>{'use strict';h.Tree={init(){const t=c.tfId('tb_tree_root'),e=t.firstElementChild;e&&(t.attachShadow({mode:e.getAttribute('shadowroot')}).appendChild(e.content),e.remove()),'visual'===h.mode&&i.top.document.body.appendChild(t),this.el=t.shadowRoot.querySelector('.wrapper'),s.loadCss(s.builder_url+'/css/editor/modules/tree',null,null,this.el),s.on('themify_builder_ready',()=>{const e=h.MainPanel.el.getRootNode().querySelector('#module_combine_style');t.shadowRoot.prepend(h.ToolBar.getBaseCss(),e.cloneNode(!0),this.getGridCss()),setTimeout(()=>{this.events(),this.draggable(),this.resize()},200)},!0,h.is_builder_ready)},getGridCss(){const e=c.tfId('themify_concate-css')||c.tfId('themify-builder-style-css'),i=e.sheet.cssRules,s=[],n=[],o=ThemifyStyles.getColSize(),l=ThemifyStyles.getArea(),r=ThemifyStyles.getGutter(),t=c.createElement('style');for(let e in r)n.push('--'+e+':'+r[e]);let a;for(let t=i.length-1;-1<t;--t){let e=i[t].selectorText;if(e)if(-1!==e.indexOf('.row_inner')&&-1!==e.indexOf('.subrow_inner')&&-1!==i[t].cssText.indexOf('--col')&&-1!==i[t].cssText.indexOf('grid-template-areas')){let s=i[t].cssText.replace(e,'').replace('{','').replace('}','').trim().split(';');a=e;for(let t=s.length-1;-1<t;--t)if(s[t]){let e=s[t].split(':')[0].trim();if(e&&void 0===o[e]&&void 0===l[e]&&void 0===r[e]){let e=s[t].replace(';','').trim();-1===n.indexOf(e)&&n.push(e)}}}else-1===e.indexOf('.module_column')||-1===i[t].cssText.indexOf('grid-area')&&-1===i[t].cssText.indexOf('grid-template-columns')||s.push(i[t].cssText.trim())}for(let e in o)n.push(e+':'+o[e]);for(let e in l)n.push(e+':'+ThemifyStyles.normalizeArea(l[e]));return s.push(a+'{'+n.join(';')+'}'),t.id='grid_css',t.innerHTML=s.join(''),t},getTree(){console.time('TREE');const e=c.createElement('template'),o=c.createElement('button'),t=(o.type='button',o.className='tf_plus_icon tf_rel',e.innerHTML=h.Builder.get().el.outerHTML,e.content.firstChild.children),l=(c.createDocumentFragment(),s=>{const n=s[0].classList.contains('module_row')?'row':'subrow';for(let t=s.length-1;-1<t;--t)if(s[t].classList.contains('module_'+n)){s[t].classList.remove('themify_builder_row','tf_clearfix'),s[t].removeAttribute('style');let i=s[t].children;for(let t=i.length-1;-1<t;--t){let e=i[t].classList;if(e.contains(n+'_inner')||e.contains('tb_row_info')){i[t].removeAttribute('style');let s=i[t].children;for(let t=s.length-1;-1<t;--t)if(s[t].classList.contains('module_column')){s[t].removeAttribute('style');let i=s[t].children;for(let t=i.length-1;-1<t;--t){let e=i[t].classList;if(e.contains('tb_holder')){i[t].removeAttribute('style');let s=i[t].children;for(let t=s.length-1;-1<t;--t){let n=s[t],e=n.classList;if(e.contains('active_module'))if(n.removeAttribute('style'),e.contains('active_subrow')){let t=n.children;for(let e=t.length-1;-1<e;--e)t[e].classList.contains('module_subrow')||t[e].remove();l(t)}else{let e=c.createElement('div'),t=c.createElement('div'),s=h.Registry.get(n.dataset.cid),i=s.getExcerpt();n.innerHTML=s.getImage(),e.innerHTML=s.getName(),e.className='module_name',t.className='excerpt',t.innerHTML=i,n.append(e,t)}else n.remove()}}else e.contains('tb_grid_drag')||e.contains('tb_col_side')||i[t].remove()}let e=o.cloneNode(!0);e.textContent='row'==n?'Column':'SubColumn',s[t].prepend(e)}else s[t].remove()}else i[t].remove()}let e=o.cloneNode(!0);e.textContent=n,s[t].prepend(e)}else s[t].remove()});return l(t),console.timeEnd('TREE'),e.content},open(){const e=this.el.tfClass('content')[0],t=this.getTree();for(;null!==e.firstChild;)e.lastChild.remove();e.appendChild(t),h.ToolBar.el.tfClass('tree')[0].classList.add('active'),this.el.style.transform='translate('+s.w/2+'px,'+s.h/2+'px)',this.el.getRootNode().host.classList.remove('tf_hide')},extend(e){const t=e.closest('.module_subrow,.module_column,.module_row');t&&t.classList.toggle('expand')},events(){this.el.tfOn(s.click,e=>{e.stopPropagation();const t=e.target;t.closest('.tf_close')?this.close():t.closest('.minimize')?this.minimize():this.extend(t)},{passive:!0})},close(){this.el.getRootNode().host.classList.add('tf_hide'),h.ToolBar.el.tfClass('tree')[0].classList.remove('active');const e=this.el.tfClass('content')[0];for(;null!==e.firstChild;)e.lastChild.remove()},minimize(){this.el.classList.toggle('is_minimized')},draggable(){const d=this;this.el.tfClass('header')[0].tfOn('pointerdown',function(e){if(1===e.which&&(e.target.classList.contains('title')||e.target===this)){e.stopImmediatePropagation();let t,o=d.el,s=this.ownerDocument;const i=e.clientX,n=e.clientY,l=o.getBoundingClientRect(),r=l.left-i,a=l.top-n,c=(l.width,n=>{n.stopImmediatePropagation(),t=requestAnimationFrame(()=>{const e=n.clientX,t=n.clientY,s=r+e,i=a+t;o.style.transform='translate('+s+'px,'+i+'px)'})}),m=e=>{e.stopImmediatePropagation()};o.style.willChange='transform',this.tfOn('lostpointercapture',function(e){e.stopImmediatePropagation(),t&&cancelAnimationFrame(t),this.tfOff('pointermove',m,{passive:!0,once:!0}).tfOff('pointermove',c,{passive:!0}),o.style.willChange='',!1===d.isStandalone&&(d.updateStorage(),d.setupLightboxSizeClass()),s.body.classList.remove('tb_start_animate','tb_drag_lightbox'),h.ToolBar.el.classList.remove('tb_start_animate','tb_drag_lightbox'),h.MainPanel.el.classList.remove('tb_start_animate','tb_drag_lightbox'),t=o=s=null},{passive:!0,once:!0}).tfOn('pointermove',m,{passive:!0,once:!0}).tfOn('pointermove',c,{passive:!0}).setPointerCapture(e.pointerId)}},{passive:!0})},resize(){const o=this,t=this.el.tfClass('tb_resizable');for(let e=t.length-1;-1<e;--e)t[e].tfOn('pointerdown',function(e){if(1===e.which){e.stopImmediatePropagation();let t=this.ownerDocument,l=o.el,s;l.style.willChange='transform,width,height';const r=350,a=880,c=.9*t.documentElement.clientHeight,m=parseInt(getComputedStyle(l).getPropertyValue('min-height')),d=this.dataset.axis,h=parseInt(l.offsetHeight,10),p=parseInt(l.offsetWidth,10),f=e.clientX,u=e.clientY,i=o=>{o.stopImmediatePropagation(),s=requestAnimationFrame(()=>{let e;const t=o.clientX,s=o.clientY,i=new DOMMatrix(getComputedStyle(l).transform);if('w'===d)(e=(e=f+p-t)>a?a:e)>=r&&e<=a&&(i.m41+=parseInt(l.style.width)-e,l.style.width=e+'px');else{const n='-y'===d||'ne'===d||'nw'===d?u+h-s:h+s-u;(e='sw'===d||'nw'===d?f+p-t:p+t-f)>a&&(e=a),('se'===d||'x'===d||'sw'===d||'nw'===d||'ne'===d)&&e>=r&&e<=a&&('sw'!==d&&'nw'!==d||(i.m41+=parseInt(l.style.width)-e),l.style.width=e+'px'),('se'===d||'y'===d||'-y'===d||'sw'===d||'nw'===d||'ne'===d)&&n>=m&&n<=c&&('-y'!==d&&'nw'!==d&&'ne'!==d||(i.m42+=parseInt(l.style.height)-n),l.style.height=n+'px')}l.style.transform='translate('+i.m41+'px,'+i.m42+'px)'})},n=function(e){e.stopImmediatePropagation(),s&&cancelAnimationFrame(s),this.tfOff('pointermove',i,{passive:!0}),l.style.willChange='',t.body.classList.remove('tb_start_animate'),t=l=s=null};this.tfOn('pointermove',i,{passive:!0}).tfOn('lostpointercapture',n,{passive:!0,once:!0}).setPointerCapture(e.pointerId),t.body.classList.add('tb_start_animate')}},{passive:!0})}},h.isGSPage||h.Tree.init()})(tb_app,Themify,document,window);