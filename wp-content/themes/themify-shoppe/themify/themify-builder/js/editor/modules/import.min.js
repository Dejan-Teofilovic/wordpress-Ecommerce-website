let TB_Import;((u,s,t)=>{'use strict';TB_Import={el:null,init(e){const t=e.dataset.type;t&&('file'===t?this.file():this.post(e))},file(){u.Spinner.showLoader('spinhide');const e=t.createElement('input');u.Helper.loadJsZip(),e.type='file',e.accept='.zip,.txt,.json',e.tfOn('change',e=>{e.currentTarget.remove(),this.fileImport(e.currentTarget.files[0])},{passive:!0,once:!0}).click()},fileImport(h){return new Promise((p,c)=>{const e={msg:themifyBuilder.i18n.dialog_import_page_post,buttons:{no:themifyBuilder.i18n.replace_builder,yes:themifyBuilder.i18n.append_builder}};u.LiteLightBox.confirm(e).then(async o=>{if(o)try{u.Spinner.showLoader();const t=(e,t)=>{try{const i={custom_css:(e=JSON.parse(e)).custom_css};delete e.custom_css,t?i.used_gs=JSON.parse(t):e.used_gs&&(i.used_gs=e.used_gs,delete e.used_gs),e.builder_data&&(e=e.builder_data),i.builder_data=e,u.Builder.get().reLoad(i,'no'!==o).then(p).catch(c)}catch(e){throw e}};if('text/plain'===h.type||'application/json'===h.type){const e=new FileReader;e.tfOn('loadend',function(e){try{if(this.readyState!==FileReader.DONE)throw'';t(e.target.result)}catch(e){u.Spinner.showLoader('error'),TF_Notification.showHide('error',themifyBuilder.i18n.importBuilderNotExist),c(e)}},{passive:!0,once:!0}).readAsText(h)}else{if('application/x-zip-compressed'!==h.type&&'application/zip'!==h.type)throw Error(themifyBuilder.i18n.importWrongFormat);{await u.Helper.loadJsZip();const i=new JSZip,r=await i.loadAsync(h),a=r.files;if(!a)throw Error(themifyBuilder.i18n.zipFileEmpty);{const s='builder_data_export.txt',n='builder_gs_data_export.txt';if(void 0===a[s])throw Error(themifyBuilder.i18n.importBuilderNotExist);{const l=[],d=(l.push(r.file(a[s].name).async('text')),void 0!==a[n]&&l.push(r.file(a[n].name).async('text')),await Promise.all(l));t(d[0],d[1])}}}}}catch(e){u.Spinner.showLoader('error'),e.message&&TF_Notification.showHide('error',e.message),c(e)}else p()})})},async post(e){try{await u.LightBox.save(),u.LightBox.el.classList.add('tb_import_post_lightbox');const i=await u.LocalFetch({action:'builder_import',type:e.dataset.type}),o=e.closest('ul').getBoundingClientRect(),r=(u.LightBox.setStandAlone(o.left,o.top),await u.Spinner.showLoader('done'),await u.LightBox.open({loadMethod:'html',contructor:!0,save:!1,data:i})),a=function(e){e.preventDefault(),e.stopPropagation();const t={msg:themifyBuilder.i18n.dialog_import_page_post,buttons:{no:themifyBuilder.i18n.replace_builder,yes:themifyBuilder.i18n.append_builder}},i={action:'builder_import_submit',data:u.Forms.serialize('tb_options_import')};for(let e in i.data)i.data[e]&&'0'!==i.data[e]||delete i.data[e];0<Object.keys(i.data).length?u.LiteLightBox.confirm(t).then(t=>{t&&(u.Spinner.showLoader(),u.LocalFetch(i).then(e=>{void 0!==e.builder_data?(u.LightBox.close(),u.Builder.get().reLoad(e,'no'!==t)):(u.Spinner.showLoader('error'),TF_Notification.showHide('error',themifyBuilder.i18n.postBuilderNotExist))}).catch(()=>{u.Spinner.showLoader('error')}))}):TF_Notification.showHide('error',themifyBuilder.i18n.importSelectPost)};let t=r.querySelector('#tb_submit_import_form');t&&t.tfOn(s.click,a),s.on('themify_builder_lightbox_close',e=>{t&&t.tfOff(s.click,a),e.classList.remove('tb_import_post_lightbox'),t=null},!0)}catch(e){throw u.Spinner.showLoader('spinhide'),e}}}})(tb_app,Themify,document);