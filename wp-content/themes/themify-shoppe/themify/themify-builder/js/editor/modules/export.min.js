let TB_Export;((y,b,m)=>{'use strict';TB_Export={async init(){let t=y.Builder.get().toJSON(!0),r={},e=Promise.resolve(),n=['background_slider','shortcode_gallery'],o=(e,i)=>{const o=e.styling||e.mod_settings;if(o)for(let l=n.length-1;-1<l;--l)if(o[n[l]]&&-1===o[n[l]].indexOf('path=')){let e=b.hash(o[n[l]]).toString();if(i){if(void 0===i[e])return;let t=i[e].split(' ids');for(let e=t.length-1;-1<e;--e)t[e]=t[e].trim(),'='===t[e][0]&&t.splice(e,1);']'!==(t=t.join(' ')).slice(-1)&&(t+=']'),o[n[l]]=i[e]=t}else r[e]=o[n[l]]}},s=(l,i)=>{if(l)for(let t=l.length-1;-1<t;--t)if(o(l[t],i),l[t].cols)for(let e=l[t].cols.length-1;-1<e;--e)o(l[t].cols[e],i),s(l[t].cols[e].modules,i)};window.navigator.onLine&&(s(t),0<Object.keys(r).length&&(e=await y.LocalFetch({data:r,action:'builder_prepare_export'})));const l=await e;let i=y.Builder.get().customCss,a=themifyBuilder.post_title,c=new Date,d=c.getFullYear()+'_'+c.getMonth()+'_'+c.getDate(),_=new JSZip,f=y.GS.findUsedItems(t),p=null,g=(e,t)=>{let l=m.createElement('a');l.download=t,l.rel='noopener',l.href=URL.createObjectURL(e),setTimeout(()=>{URL.revokeObjectURL(l.href),l=null},7e3),l.click()};if(l&&s(t,l),t={builder_data:t},i&&(t.custom_css=i.trim()),f){p={};for(let t=f.length-1;-1<t;--t){let e=y.Helper.cloneObject(y.GS.styles[f[t]]);delete e.id,delete e.url,p[f[t]]=e}_.file('builder_gs_data_export.txt',JSON.stringify(p))}_.file('builder_data_export.txt',JSON.stringify(t));try{const u=await _.generateAsync({type:'blob'}),h=a+'_themify_builder_export_'+d+'.zip';g(u,h)}catch(e){p&&(t.used_gs=p),t=JSON.stringify(t),g(new Blob([t],{type:'application/json'}),a+'_themify_builder_export_'+d+'.txt')}y.Spinner.showLoader('done')}}})(tb_app,Themify,document);