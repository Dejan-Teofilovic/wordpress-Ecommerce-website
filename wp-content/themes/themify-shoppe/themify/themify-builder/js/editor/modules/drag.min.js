(($,W,X,V,j)=>{'use strict';if(W.Drag=e=>{if(!0!==W.isGSPage){let q;e.tfOn('pointerdown',e=>{1!==e.which||W.isPreview||e.target.closest('.tb_dragger,.tb_disable_sorting,.tb_editor_on')?q=null:(q=e.target).classList.contains('tb_grid_drag')?(q=null,W.columnResize(e)):0===q.tagName.indexOf('TB-')&&e.composedPath()[0].classList.contains('tb_move')&&(q=e.composedPath()[0])},{passive:!0}).tfOn('dragstart',function(O){if(q&&O.target.nodeType!==Node.TEXT_NODE){let x=O.target.closest('[draggable]');if(!x||'desktop'!==W.activeBreakPoint&&x.classList.contains('active_module'))O.preventDefault(),q=null;else{let y=x.classList,w=y.contains('module_row'),e=w,L=!w&&y.contains('module_column');if(e&&!q.classList.contains('tb_move'))O.preventDefault(),q=null;else{w||L||(w=y.contains('page_break_module')||y.contains('predesigned_row')||y.contains('tb_item_row')),q=null,O.stopImmediatePropagation();let o,r,p=null,g=w?'row':L?'column_move':y.contains('tb_grid')?'column':'module',a=[g],f=j.body,m=0,_=0,u,n,t,l=null,b=null,s,i,h=[W.ToolBar.el.getRootNode().host,V.document.tfId('tb_fixed_bottom_scroll')],d=W.Builder.get().el,c=[V.document.body],v=j.createElement('div');const C=t=>{if(null===b&&l){b=!0;let e='tb_main_toolbar_root'===t||'wpadminbar'===t?'-':'+';e+='='+i*s+'px',l.stop().animate({scrollTop:e},{duration:10,complete(){!0===b&&(b=null,C(t))}})}},T=function(){t&&clearInterval(t),s=5,t=setInterval(()=>{s<51?s+=5:(clearInterval(t),t=null)},1200),(u=null)!==p&&(p.style.display='none');for(let e=d.querySelectorAll('[data-pos]'),t=e.length-1;-1<t;--t)e[t].removeAttribute('data-pos');C(this.id)},P=()=>{t&&clearInterval(t),b=t=null,l.stop()},S=e=>{if(t&&clearInterval(t),!0===e){for(let e=h.length-1;-1<e;--e)h[e].tfOff('dragenter',T,{passive:!0}).tfOff('dragleave',P,{passive:!0});w&&'visual'===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="100"]')}),h=b=t=s=l=i=null}else if(i=1,'visual'!==W.mode&&((l=(l=W.ToolBar.el.getRootNode().host.closest('.interface-interface-skeleton__content'))||j.tfClass('edit-post-layout__content')[0])?i/=2:l=null),l=null===l?'desktop'===W.activeBreakPoint?$('body,html'):$('body,html',V.document):$(l),w&&'visual'===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="50"]')}),0<i)for(let e=h.length-1;-1<e;--e)h[e].tfOn('dragenter',T,{passive:!0}).tfOn('dragleave',P,{passive:!0})},A=e=>{e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed='none',u&&u.removeAttribute('data-pos'),null!==p&&(p.style.display='none')},N=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),o&&(o.style.top=e.clientY-r+'px'),!e.target||null!==b||e.target===f||e.target===x||'module'===g&&e.target.classList.contains('module_row'))A(e);else if((null===p||e.target!==p&&!e.target.classList.contains('tb_sortable_placeholder'))&&(e.dataTransfer.effectAllowed='move',0===m||0===_||10<e.clientY-m||10<m-e.clientY||10<e.clientX-_||10<_-e.clientX||e.target!==u)){m=e.clientY,_=e.clientX;let t=e.target;const s=t.getBoundingClientRect();let r=.5<(m-s.top)/s.height?'bottom':'top';if(!0===L){let a,e=t.classList;if(e.contains('row_inner')||e.contains('row_inner'))t=(a=t).tfClass('module_column')[0],r=null;else if(e.contains('tb_col_side'))r=e[1].replace('tb_col_side_',''),t=t.parentNode,a=t.parentNode;else{if(!e.contains('module_column'))return;r=.5<(_-s.left)/s.width?'right':'left',a=t.parentNode}let o=a.dataset.dragW,l=t.dataset.dragArea;if(!o||!l){const i=getComputedStyle(a);if(!o){const n=a.closest('[data-cid]');if(!n)return;const d=a.offsetWidth;let e=W.Registry.get(n.dataset.cid).getSizes('gutter'),t=(e=(e=e?ThemifyStyles.getGutterValue(e):'')||i.getPropertyValue('--colG')).replace(parseFloat(e).toString(),'')||'%';e=parseFloat(e),o=0===e?'none':'%'===t?parseFloat(parseFloat(d*e/100).toFixed(2)).toString():'em'===t?e*parseFloat(i.getPropertyValue('font-size')):e,a.dataset.dragW=o;for(let e=a.children,t=e.length-1;-1<t;--t)for(let a=e[t].children,l=a.length-1;-1<l;--l)if(a[l].classList.contains('tb_col_side')){a[l].style.marginLeft=a[l].style.marginRight='';let e=a[l].classList.contains('tb_col_side_right')?'50':'-50',t=(a[l].style.width='none'===o?'':o+'px',a[l].style.transform='none'===o?'translateX('+e+'%)':'',a[l].getBoundingClientRect().left);t<0?a[l].style.marginLeft='10px':t>=j.documentElement.clientWidth&&(a[l].style.marginRight='10px')}}if(!l){if(l=i.getPropertyValue('--area')){for(let t=(l=l.split('" "')).length-1;-1<t;--t){let e=l[t].replaceAll('"','').split(' ');e=Array.from(new Set(e)),l[t]=e.join(' ')}l='"'+l.join('" "')+'"'}else l='1';a.dataset.dragArea=l}}if(null===r)return;if('1'!==l&&!t.classList.contains('tb_drag_side_column')&&!t.classList.contains('tb_drag_one_column')){const c=getComputedStyle(t).getPropertyValue('grid-area').split('/')[0].replace('"','').trim();-1===l.indexOf(c+' ')&&-1===l.indexOf(' '+c)?t.classList.add('tb_drag_one_column'):t.classList.add('tb_drag_side_column')}t.classList.contains('tb_drag_one_column')&&(r=.5<(m-s.top)/s.height?'right':'left')}if(t!==h[0]&&t!==h[1]){if(!o&&!1===L){if(t.classList.contains('module_column')){if(!(t=t.tfClass('tb_holder')[0]))return void A(e)}else t.classList.contains('tb_dragger')&&(t=t.parentNode);if(t.classList.contains('tb_holder')&&0<t.childElementCount&&(t='top'===r&&t.firstChild!==x?t.firstChild:t.lastChild)===x)return void A(e)}if(u&&u!==t){if(!1===L){const a='top'===r?t.previousSibling:t.nextElementSibling;if(a===u){const l=a.dataset.pos;if('top'===r&&'bottom'===l||'bottom'===r&&'top'===l)return}}u.removeAttribute('data-pos')}t.dataset.pos!==r&&(t.dataset.pos=r,null!==p&&(p.style.display='',t.classList.contains('tb_holder')?t.appendChild(p):'top'===r?t.before(p):t.after(p))),u=t}}},F=function(e){e.stopImmediatePropagation(),c.push(W.MainPanel.el),c.push(W.ToolBar.el.getRootNode().host);for(let e=c.length-1;-1<e;--e)c[e].classList.add('tb_start_animate','tb_drag_start','tb_drag_'+a[0]),a[1]&&c[e].classList.add(a[1]);if(W.SmallPanel.hide(),W.ActionBar.clear(),this.classList.add('tb_draggable_item'),!0===L){this.parentNode.classList.add('tb_column_drag_inner');const l=d.querySelectorAll('.row_inner,.subrow_inner');for(let e=l.length-1;-1<e;--e){let t=l[e].children,a=l[e].getBoundingClientRect().width-5;for(let e=t.length-1;-1<e;--e)t[e].offsetWidth+t[e].offsetLeft<a&&t[e].classList.add('tb_hide_drag_col_right')}}S(),o&&(o.style.top=e.clientY+'px')},B=e=>{e.stopImmediatePropagation()},I=e=>{e.target&&(e.preventDefault(),e.stopImmediatePropagation()),n=!0;let t=e.target||e;if(t.classList.contains('module_column')||t.classList.contains('tb_col_side'))t=L?t.closest('.module_column'):t.querySelector('[data-pos]');else if(L){t=null;for(let e=j.tfClass('tb_column_drag_inner'),t=e.length-1;-1<t;--t)e[t].classList.remove('tb_column_drag_inner')}else t.classList.contains('tb_dragger')&&(t=t.closest('[draggable]'));if(!(t=(t===p||t.classList.contains('tb_sortable_placeholder'))&&(t=t.closest('.tb_active_builder').querySelector('[data-pos]')).classList.contains('tb_sortable_placeholder')?t.closest('.tb_holder'):t)||'module'===g&&t.classList.contains('module_row'))x.classList.remove('tb_draggable_item');else{W.ActionBar.clear();const a=x.closest('.module_row'),l=null!==a,o=l?x:x.cloneNode(!0),r=t.dataset.pos,s=e=>{const t=e.closest('.module_row');t&&t.classList.toggle('tb_row_empty',void 0===t.tfClass('active_module')[0])};if(p&&p.remove(),W.undoManager.start('move'),x.classList.remove('tb_draggable_item'),l||(o.style.display='none'),t.classList.contains('tb_holder')?t.appendChild(o):L||('top'===r?t.before(o):t.after(o)),L||l){const i=L?W.Drop.column(o,t,r):Promise.resolve();i.then(()=>{X.trigger('tb_'+g+'_sort',[o]),W.Utils._onResize(!0),s(a),s(t),W.undoManager.end('move')})}else{let e=y.contains('tb_grid')?'grid':y.contains('page_break_module')?'pagebreak':'predesign',t=x.dataset.slug,a='grid'===e?'row':g;x.dataset.type&&(e=x.dataset.type,'row'===a&&y.contains('library_item')&&(e='library')),W.Drop[a](o,e,t).then(()=>{X.trigger('tb_'+g+'_sort',[o]),s(o),'module'===a&&'part'!==e&&'module'!==e?W.undoManager.clear('move'):W.undoManager.end('move')}).catch(()=>{W.undoManager.clear('move')})}}};if(v.className='tb_sortable_helper tf_box tf_overflow',y.contains('active_subrow')&&a.push('tb_drag_subrow'),e){if(j.body.classList.add('tb_drag_row'),'visual'!==W.mode){o=v.cloneNode(),v.style.opacity=0;const k=x.getBoundingClientRect();o.style.width=k.width+'px',o.style.left=k.left+'px',j.body.appendChild(o),r=o.offsetHeight/2}}else if('module'===g||L)if(L||y.contains('active_subrow'))v.innerHTML=L?'Column':'Subrow';else{let e=x.dataset.slug||W.Registry.get(x.dataset.cid).get('mod_name');if(e&&themifyBuilder.modules[e]){const z=themifyBuilder.modules[e],R=z.icon,M=j.createElement('span');M.textContent=z.name,M.className='tf_vmiddle',R&&v.appendChild(W.Helper.getIcon('ti-'+R)),v.appendChild(M)}}else if('column'===g)v.className+=' '+x.className,v.innerHTML=x.innerHTML;else if('row'===g&&(y.contains('page_break_module')||y.contains('predesigned_row'))){const D=y.contains('page_break_module')?'page_break_title':'predesigned_title';v.textContent=x.tfClass(D)[0].textContent}L||!w&&'visual'===W.mode||((p=j.createElement('div')).className='tb_sortable_placeholder tf_rel tf_w');const E=v.querySelector('.add_module_btn');null!==E&&E.remove(),j.body.appendChild(v),O.dataTransfer.effectAllowed='move',O.dataTransfer.setData('Text','id'),O.dataTransfer.setDragImage(v,v.offsetWidth/2+2,v.offsetHeight/2),x.tfOn('dragend',function(e){if(e.stopImmediatePropagation(),j.body.tfOff('dragover',N),d.tfOff(['dragenter','dragleave','pointermove','pointerover','pointerout','pointerenter','pointerleave','mousemove','mouseover','mouseout','mouseenter','mouseleave'],B,{passive:!0}).tfOff('drop',I,{once:!0}),this.tfOff('drag',F,{once:!0,passive:!0}),!n){const t=d.querySelector('[data-pos]');t&&I(t)}v.remove(),o&&o.remove(),p&&p.remove();for(let e=j.querySelectorAll('[data-drag-w],[data-drag-area],[data-pos]'),t=e.length-1;-1<t;--t)e[t].removeAttribute('data-pos'),e[t].removeAttribute('data-drag-w'),e[t].removeAttribute('data-drag-area');for(let e=j.querySelectorAll('.tb_hide_drag_col_right,.tb_drag_one_column,.tb_drag_side_column,.tb_column_drag_inner'),t=e.length-1;-1<t;--t)e[t].classList.remove('tb_hide_drag_col_right','tb_drag_one_column','tb_drag_side_column','tb_column_drag_inner');if(this.classList.remove('tb_draggable_item','tb_drag_one_column','tb_drag_side_column'),S(!0),'visual'!==W.mode)for(let e=j.tfClass('is-drop-target'),t=e.length-1;-1<t;--t)e[t].classList.remove('is-drop-target');for(let e=c.length-1;-1<e;--e)c[e].classList.remove('tb_start_animate','tb_drag_start','tb_drag_start_'+a[0],'tb_drag_'+a[0]),a[1]&&c[e].classList.remove(a[1]);p=n=q=x=y=u=v=o=r=f=d=_=m=a=g=L=c=null,W.ActionBar.clear()},{once:!0,passive:!0}),'visual'===W.mode&&c.push(f);for(let e=c.length-1;-1<e;--e)c[e].classList.add('tb_drag_start_'+a[0]),a[1]&&c[e].classList.add(a[1]);x.tfOn('drag',F,{once:!0,passive:!0}),j.body.tfOn('dragover',N),d.tfOn('dragenter dragleave',B,{passive:!0}).tfOn('drop',I,{once:!0}),X.isTouch||d.tfOn(['pointermove','pointerover','pointerout','pointerenter','pointerleave','mousemove','mouseover','mouseout','mouseenter','mouseleave'],B,{passive:!0})}}}else O.preventDefault(),q=null})}},W.columnResize=e=>{e.stopPropagation();const t=j.body.classList,a=e.target,o=[],r=[],s=a.parentNode,i=s.parentNode,l=getComputedStyle(i),z=i.childElementCount,R=i.offsetWidth,n=a.classList.contains('tb_drag_right')?'w':'e',d=j.createElement('div'),c=j.createElement('div'),p=getComputedStyle(s).getPropertyValue('grid-area').split('/')[0].replace('"','').trim(),g=p&&'auto'!==p&&'initial'!==p&&'none'!==p?getComputedStyle(i).getPropertyValue('--area').replace(/  +/g,' ').trim().split('" "'):'',f=l.getPropertyValue('column-gap'),m=parseFloat(f)||0;let _=getComputedStyle(i).getPropertyValue('--col').replace(/\s\s+/g,' ').trim(),u,b,h=!1,v=e.clientX,y=100,w=0,L=0,x=0;if(X.trigger('disableInline'),'none'===_)_='';else if(-1!==_.indexOf('repeat'))if(-1===_.indexOf('auto-fit')&&-1===_.indexOf('auto-fill')){let o='',r=_.replace(/\s\,\s|\s\,|\,\s/g,',').replace(/\s\(\s|\s\(|\(\s/g,'(').replaceAll(' )',')').trim().split(' ');for(let l=0,e=r.length;l<e;++l)if(-1!==r[l].indexOf('repeat')){let e=r[l].split('(')[1].replace(')','').split(','),t=parseInt(e[0]),a=e[1].trim();isNaN(t)&&(a='1fr',t=z),o+=' '+(' '+a).repeat(t)}else o+=' '+r[l];_=o.trim()}else _='';if(g){let l=0;for(let a=g.length-1;-1<a;--a)if(-1!==g[a].indexOf(p)){let t=g[a].replace(/\s\s+/g,' ').replaceAll('"','').trim().split(' ');for(let e=t.length-1;-1<e;--e)t[e]===p&&(o.push(e),l=a);if(0<o.length)break}if(0<o.length){const D=Math.min.apply(null,o)-1,q=Math.max.apply(null,o)+1,A=i.children,V='w'==n?q:D,N=g[l].replace(/\s\s+/g,' ').replaceAll('"','').trim().split(' ')[V]?.trim();if(!N)return;for(let e=g.length-1;-1<e;--e)if(-1!==g[e].indexOf(N)){let t=g[e].replace(/\s\s+/g,' ').replaceAll('"','').trim().split(' ');for(let e=t.length-1;-1<e;--e)t[e]===N&&r.push(e);if(0<r.length)break}for(let e=A.length-1;-1<e;--e)if(s!==A[e]&&N===getComputedStyle(A[e]).getPropertyValue('grid-area').split('/')[0].replace('"','').trim()){u=A[e];break}}const S=g[0].trim().split(' ').length;if(_){const F=S-_.split(' ').length;0<F&&(_+=' 1fr'.repeat(F))}else _='1fr '.repeat(S).trim()}else{if(u='w'==n?s.previousElementSibling||s.nextElementSibling:s.nextElementSibling||s.previousElementSibling,!_){const I=[],E=i.children;for(let e=0,t=E.length;e<t;++e)I.push(E[e].getBoundingClientRect().width);const k=Math.min.apply(null,I).toFixed(2).toString();for(let e=I.length-1;-1<e;--e)I[e]=k===I[e].toFixed(2).toString()?'1fr':(I[e]/k).toFixed(2).toString().replace('0.','.')+'fr';_=I.join(' ')}const B=X.convert(i.children);o.push(B.indexOf(s)),r.push(B.indexOf(u))}(_=_.split(' '))[o[0]]||(o[0]=o[0]%_.length),_[r[0]]||(r[0]=r[0]%_.length);const O=_.length;f?-1!==f.indexOf('px')?x=(O-1)*m:-1!==f.indexOf('em')&&(L=(O-1)*m):y-=(O-1)*m;for(let t=O-1;-1<t;--t){let e=_[t];-1!==e.indexOf('fr')?w+=parseFloat(e):-1!==e.indexOf('%')?y-=parseFloat(e):-1!==e.indexOf('em')?L+=parseFloat(e):-1!==e.indexOf('px')&&(x+=parseFloat(e))}0!==L&&(L=parseFloat(l.getPropertyValue('font-size'))*L);const C=o.length,T=r.length,M=parseFloat((parseFloat(R*y/100)-x-L)/w),P=(d.className=c.className='tb_grid_drag_tooltip',a.classList.add('tb_drag_grid_current'),s.classList.add('tb_element_clicked'),'w'==n?(d.className+=' tb_grid_drag_right_tooltip',c.className+=' tb_grid_drag_left_tooltip'):(d.className+=' tb_grid_drag_left_tooltip',c.className+=' tb_grid_drag_right_tooltip'),s.style.willChange='width',u&&(u.style.willChange='width'),e=>{e.stopImmediatePropagation(),b=requestAnimationFrame(()=>{!1===h&&(h=!0,W.ActionBar.clear(),W.undoManager.start('style'),a.append(d,c));let t=parseInt(e.clientX)-v;if(v=e.clientX,0!==t){'e'==n&&(t*=-1);let e=parseFloat(t/M);if(0!==e){e=parseFloat(e/(C+T));let t=parseFloat(_[o[0]])+e,a=parseFloat(_[r[0]])-e;if(.001<t&&.001<a){t=t.toFixed(3)+'fr',a=a.toFixed(3)+'fr';for(let e=C-1;-1<e;--e)_[o[e]]=t;for(let e=T-1;-1<e;--e)_[r[e]]=a;i.style.setProperty('--col',_.join(' ')),d.textContent=t+' / '+s.offsetWidth+'px',u&&(c.textContent=a+' / '+u.clientWidth+'px')}}}})});a.tfOn('lostpointercapture',function(e){e.stopImmediatePropagation(),this.tfOff('pointermove',P,{passive:!0}),b&&cancelAnimationFrame(b),requestAnimationFrame(()=>{if(d.remove(),c.remove(),W.ActionBar.clear(),s.classList.remove('tb_element_clicked'),this.classList.remove('tb_drag_grid_current'),t.remove('tb_start_animate','tb_drag_grid_start'),s.style.willChange='',u&&(u.style.willChange=''),h){const e=i.closest('[data-cid]');for(let e=_.length-1;-1<e;--e)_[e]=parseFloat(parseFloat(_[e]).toFixed(3).replace('0.','.')).toString()+'fr';W.Registry.get(e.dataset.cid).setCols({size:_.join(' ')}),i.style.setProperty('--col',''),W.Utils.setCompactMode([s,u]),X.trigger('tb_grid_changed',e),W.Utils._onResize(!0),W.undoManager.end('style')}h=b=u=null})},{once:!0,passive:!0}).tfOn('pointermove',P,{passive:!0}).setPointerCapture(e.pointerId),t.add('tb_start_animate','tb_drag_grid_start')},X.isTouch,0){const d=['application/x-zip-compressed','application/zip','text/plain','application/json'],c=['image/webp','image/png','image/jpeg','image/gif','image/bmp'],p=async e=>{let r=e.getData('text/html')||'',t=e.files;if((r=r&&r.trim())||t&&0<t.length){let l=new Map,a,o=e.files;if(o&&0<o.length)for(let t=o.length-1;-1<t;--t){let e=o[t].type;e&&(-1!==d.indexOf(e)?a=a||o[t]:-1!==c.indexOf(e)&&l.add(o[t]))}else{const s=j.createElement('template'),i=(s.innerHTML=r,(r=s.content).querySelectorAll('img'));for(let t=i.length-1;-1<t;--t){let e=i[t].src||i[t].dataset.src;e&&l.set(e,1)}for(let e=r.children,t=e.length-1;-1<t;--t)e[t].tagName}if(0<l.size){const n=themifyBuilder.i18n.upload_images.replaceAll('%to%',l.size);let a=1;for(let[t,e]of l){await TF_Notification.show('info',n.replaceAll('%from%',a).replaceAll('%post%',t));let e=await W.LocalFetch({action:'tb_download_image',url:t});l.set(t,e.data.new),++a}}a&&W.ToolBar.initImport({target:j.createElement('div')}).then(()=>{TB_Import.fileImport(a)})}};let n=!1;j.tfOn('dragenter',o=>{if(o.dataTransfer.types&&o.target&&'tb_drop_zone'!==o.target.id){let l=!1;for(let t=o.dataTransfer.types,a=t.length-1;-1<a;--a){let e=o.dataTransfer.items[a].kind;if('Files'===t[a]&&'file'===e){let e=o.dataTransfer.items[a].type;if(-1!==d.indexOf(e)||-1!==c.indexOf(e)){l=!0;break}}else if('text/html'===t[a]&&'string'===e){l=!0;break}}if(!0===l){o.stopPropagation();const t=j.tfId('tb_drop_zone'),a=e=>{e.stopPropagation(),j.body.classList.remove('tb_drop_file')};if(!1===n){n=!0;const r=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect='copy'},s=e=>{e.stopPropagation(),t.tfOff('drop',i,{once:!0}).tfOff('dragleave',a,{passive:!0,once:!0}).tfOff('dragover',r),j.tfOff('dragend',s,{passive:!0,once:!0}),a(e),n=!1},i=e=>{e.stopPropagation(),e.preventDefault(),s(e),p(e.dataTransfer)};t.tfOn('dragover',r).tfOn('drop',i,{once:!0}),j.tfOn('dragend',s,{passive:!0,once:!0})}t.tfOn('dragleave',a,{passive:!0,once:!0}),j.body.classList.add('tb_drop_file')}}},{passive:!0}),j.tfOn('paste',e=>{e.target.isContentEditable||'INPUT'===e.target.tagName||'TEXTAREA'===e.target.tagName||p(e.clipboardData)},{passive:!0})}})(jQuery,tb_app,Themify,window.top,document);