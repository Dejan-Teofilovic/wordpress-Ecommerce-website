!function(){"use strict";var e=window.lodash,t=window.wp.i18n;window.ampCustomizeControls=function(n,i){const o={nonAmpCustomizerLink:null,data:{queryVar:"",l10n:{ampVersionNotice:"",rootPanelDescription:""},optionSettings:[],activeThemeSettingImports:{},mimeTypeIcons:{image:"",document:""}},boot:function(e){o.data=e,o.updatePreviewNotice(),o.extendRootDescription(),i.ajaxPrefilter(o.injectAmpIntoAjaxRequests),n.bind("ready",o.updateNonAmpCustomizeLink),n.bind("ready",o.forceAmpPreviewUrl),n.bind("ready",o.addOptionSettingNotices),n.bind("ready",o.addNavMenuPanelNotice),n.bind("ready",o.addActiveThemeSettingsImporting)},updatePreviewNotice:function(){const e=i("#customize-info .preview-notice");e.html(o.data.l10n.ampVersionNotice),o.nonAmpCustomizerLink=e.find("a[href]")[0]},updateNonAmpCustomizeLink:function(){if(!(o.nonAmpCustomizerLink instanceof HTMLAnchorElement))return;const e=()=>{const e=new URL(n.previewer.previewUrl());e.searchParams.delete(o.data.queryVar);const t=new URL(o.nonAmpCustomizerLink.href);t.searchParams.set("url",e),o.nonAmpCustomizerLink.href=t.href};e(),n.previewer.previewUrl.bind(e)},extendRootDescription:function(){const e=i("#customize-info .customize-panel-description");if(0===e.find("p").length){const t=i("<p></p>");t.html(e.html()),e.html(""),e.append(t)}const t=i("<p>"+o.data.l10n.rootPanelDescription+"</p>");e.append(t)}},a=["background_position","background_size","background_repeat","background_attachment"],r={display_header_text:"blank",background_attachment:"fixed",background_repeat:"no-repeat"},s={accent_hue_active:["accent_hue"]};function c(e){for(const t of e)t.id in o.data.activeThemeSettingImports&&t.set(o.data.activeThemeSettingImports[t.id])}const d=n.Section.extend({isContextuallyActive:()=>!0,expand(){},otherSections(){const e=[];return n.section.each((t=>{t.id!==this.id&&e.push(t)})),e.sort(((e,t)=>e.priority()-t.priority())),e},renderDetails(){const e=this.headContainer.find("dl");for(const n of this.otherSections()){const o=[];for(const e of n.controls())this.params.controls.has(e)&&o.push(e);if(!o.length)continue;let a;a="menu_locations"===n.id?(0,t.__)("Menu Locations","amp"):n.params.title;const r=i("<dt></dt>");r.text(a),e.append(r);for(const t of o){const n=i("<dd></dd>"),o=`amp-import-${t.id}`,a=i("<input type=checkbox checked>");a.attr("id",o),a.val(t.id);const r=i("<label></label>");r.attr("for",o),r.html(t.params.label),n.append(a),n.append(r),e.append(n)}}},attachEvents(){this.headContainer.find("button").on("click",(()=>{this.importSelectedSettings()}))},importSelectedSettings(){const e=this;let t=0;e.headContainer.find("input[type=checkbox]").each((function(){const e=i(this);e.prop("checked")?(function(e){if(a.includes(e.id)){const e=n("background_preset");e&&e.set("custom")}e.id in r?function(e){e.id in r&&"element"in e&&e.setting.id in o.data.activeThemeSettingImports&&e.element.set(r[e.id]!==o.data.activeThemeSettingImports[e.setting.id])}(e):c(Object.values(e.settings)),function(e){if(e.id in s){const t=[];for(const i of s[e.id]){const e=n(i);e&&t.push(e)}c(t)}}(e),e.extended(n.UploadControl)?function(e){const t=e.setting();if(!t||e.params.attachment&&e.params.attachment.url===t)return;const i=new URL(t),a=["jpg","png","gif","bmp"].includes(i.pathname.substr(-3))?"image":"document",r={id:1,url:i.href,type:a,icon:o.data.mimeTypeIcons[a],title:(s=i.pathname,decodeURIComponent(encodeURIComponent(s).replace(/%(2F|5C)/g,"/").replace(/^.*\//,"")))};var s;"image"===a&&(r.sizes={full:{url:i.href}}),e.frame||e.initFrame(),e.frame.state()||e.frame.setState("library"),e.frame.state().get("selection").set([r]),e.extended(n.BackgroundControl)?n.UploadControl.prototype.select.call(e):e.select(),e.renderContent()}(e):e.extended(n.HeaderControl)&&function(e){const t=n("header_image_data").get();t&&e.setImageFromURL(t.url,t.attachment_id,t.width,t.height)}(e)}(n.control(e.val())),e.closest("dd").remove()):t++})),e.headContainer.find("dt").each((function(){const e=i(this);e.next("dd").length||e.remove()})),0===t&&e.active(!1)},ready(){n.Section.prototype.ready.call(this),this.renderDetails()}});return n.sectionConstructor.amp_active_theme_settings_import=d,o.addActiveThemeSettingsImporting=function(){const i=new Set;for(const[t,a]of Object.entries(o.data.activeThemeSettingImports)){const o=n(t);o&&!(0,e.isEqual)(o(),a)&&i.add(t)}if(0===i.size)return;const a=new Set;if(n.control.each((e=>{for(const t of Object.values(e.settings))e.params.label&&(i.has(t.id)||e.id in s&&s[e.id].find((e=>i.has(e))))&&a.add(e)})),0===a.size)return;const r=new d("amp_settings_import",{title:(0,t.__)("Primary Theme Settings","amp"),priority:-1,controls:a});n.section.add(r)},o.injectAmpIntoAjaxRequests=function(e){const t=new URL(e.url,window.location.href);t.searchParams.has(o.data.queryVar)||(t.searchParams.append(o.data.queryVar,"1"),e.url=t.href)},o.forceAmpPreviewUrl=function(){var e;n.previewer.previewUrl.validate=(e=n.previewer.previewUrl.validate,function(t){let n=e.call(this,t);if(n){const e=new URL(n);e.searchParams.has(o.data.queryVar)||(e.searchParams.append(o.data.queryVar,"1"),n=e.href)}return n})},o.addOptionSettingNotices=function(){for(const e of o.data.optionSettings)n(e,(e=>{const i=new n.Notification("amp_option_setting",{type:"info",message:(0,t.__)("Also applies to non-AMP version of your site.","amp")});e.notifications.add(i.code,i)}))},o.addNavMenuPanelNotice=function(){n.panel("nav_menus",(e=>{e.notifications.container.length||(e.notifications.container=i('<div class="customize-control-notifications-container"></div>'),e.container.find(".panel-meta:first").append(e.notifications.container));const o=new n.Notification("amp_version",{type:"info",message:(0,t.__)("The menus here are shared with the non-AMP version of your site. Assign existing menus to menu locations in the Reader theme or create new AMP-specific menus.","amp")});e.notifications.add(o.code,o)}))},o}(wp.customize,jQuery)}();