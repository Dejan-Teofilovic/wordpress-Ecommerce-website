(($,y,C,v,w)=>{'use strict';let E;const N=function(e,t){this.$table=$(e),this.init(t)};N.prototype={$table:null,app:null,init(e){this.app=e,this.loadExtraFields(e.values),this.events(),setTimeout(()=>{this.sortableFields()},1500)},loadOrders(e,c){let d,l;try{d='string'==typeof e.field_order?JSON.parse(e.field_order):e.field_order}catch(e){}d=d||{};const t=this.$table[0].tfTag('tbody')[0],n=t.tfTag('tr'),a=[],i=v.createDocumentFragment();for(let e=0,t=n.length;e<t;++e)n[e].classList.contains('tb_no_sort')?l=n[e]:a.push(n[e]);a.sort((e,t)=>{let l,n,a=e.classList.contains('tb_contact_new_row'),i=t.classList.contains('tb_contact_new_row'),s=t=>{for(let e=c.length-1;-1<e;--e)if((c[e].label===t||c[e].id===t)&&c[e].order!==w)return c[e].order;return!1};const o=(a?e.tfClass('tb_new_field_textbox'):e.tfClass('tb_lb_option'))[0],r=(i?t.tfClass('tb_new_field_textbox'):t.tfClass('tb_lb_option'))[0];return(a&&o.dataset.order?o.dataset.order:(l=a?o.value:o.id,l=(l=a&&''===l?o.dataset.id:l).trim(),d[l]!==w?d[l]:!!a&&s(l)))-(i&&r.dataset.order?r.dataset.order:(n=i?r.value:r.id,n=(n=i&&''===n?r.dataset.id:n).trim(),d[n]!==w?d[n]:!!i&&s(n)))});for(let e=0,t=a.length;e<t;++e)i.appendChild(a[e]);for(i.appendChild(l);t.firstChild;)t.lastChild.remove();t.appendChild(i)},loadExtraFields(e){let l,t=this.$table[0].tfClass('tb_no_sort')[0];try{l=(l='string'==typeof e.field_extra?JSON.parse(e.field_extra):e.field_extra)&&l.fields}catch(e){}l=l||{fields:[]};const n=v.createDocumentFragment();for(let e=0,t=l.length;e<t;++e)n.appendChild(this.addField(l[e]));t.after(n),this.loadOrders(e,l)},events(){const e=C.click;this.$table[0].tfOn(e,e=>{const t=e.target?e.target.closest('.tb_new_field_action,.tb_add_field_option,.tb_contact_value_remove,.tb_contact_field_remove,.tb_arrow'):null;if(t){'A'===e.target.tagName&&e.preventDefault(),e.stopPropagation();const l=t.classList;if(l.contains('tb_new_field_action'))t.closest('.tb_no_sort').before(this.addField({})),this.sortableFields('refresh');else if(l.contains('tb_add_field_option'))t.previousElementSibling.appendChild(this.render.getOptions(['']));else if(l.contains('tb_arrow')){const n=t.closest('li'),a=l.contains('tb_down_row')?n.nextElementSibling:n.previousElementSibling;if(!a)return;l.contains('tb_down_row')?a.after(n):a.before(n)}else if(l.contains('tb_contact_value_remove'))t.closest('li').remove();else{const i=t.closest('.tb_contact_new_row'),s=i.tfClass('tb_new_field_textbox')[0].value.trim(),o=(i.remove(),y.LightBox.el.querySelectorAll('.tb_contact_custom_tags span'));for(let e=o.length-1;-1<e;--e)o[e].textContent.trim()==='%'+s+'%'&&o[e].remove()}this.changeObject()}}).tfOn('change',e=>{const t=e.target?e.target.closest('.tb_new_field_type,.tb_contact_new_row .tb_new_field_required, .tb_new_field_icon'):null;t&&(t.classList.contains('tb_new_field_type')&&this.switchField(t),this.changeObject())}).tfOn('input',e=>{const t=e.target?e.target.closest('.tb_contact_new_row input[type="text"], .tb_contact_new_row textarea'):null;t&&this.changeObject()}),y.LightBox.el.querySelector('.template_fields').tfOn(e,e=>{'SPAN'===e.target.tagName&&(y.LightBox.el.querySelector('#template').value+=e.target.textContent)})},sortableFields(e){const t=this,l=this.$table.find('tbody');'refresh'===e?l.sortable('refresh'):l.sortable({items:'tr:not(.tb_no_sort)',placeholder:'ui-state-highlight',axis:'y',containment:'parent',cancel:'.tb_move_opt,input,textarea,button,select,option,a',update(){t.changeObject()}}),this.sortableFieldItems(e)},sortableFieldItems(e){const t=this;this.$table.find('.control-input ul').sortable({items:'li',placeholder:'ui-state-highlight',handle:'.tb_drag_opt',axis:'y',containment:'parent',cursor:'grab',cancel:'input,textarea,button,select,option,a',update(){t.changeObject()}})},render:{call(e,t){return this[t]===w?this._default(e,t):this[t].call(this,e,t)},setType(e,t){e.dataset.type=t},getText(e,t,l){const n=v.createElement(l);return'textarea'!==l&&(n.type='tel'!==l?'text':'tel'),e.value&&(e.value=e.value.replace(/\\\\n/g,'\n'),n.value=e.value.replace(/(&quot;)|(\\\\")/g,'"')),n.className='tb_new_field_value tb_field_type_text',n.placeholder=tb_contact_l10n.pl,this.setType(n,t),n},static(e,t){const l=this._default(e,'textarea');return l.placeholder=tb_contact_l10n.static_text,this.setType(l,'static'),l},upload(e,t){return v.createElement('div')},icon(e=''){const t=ThemifyConstructor.create([{type:'icon',id:'',wrap_class:'tb_disable_dc tb_new_field_icon'}]),l=t.querySelector('.themify_field_icon'),n=(l.value=e,v.createElement('span'));return n.className='tb_input_after',n.textContent=ThemifyConstructor.label.icon,t.querySelector('.tb_field').append(n),t},getOptions(r){const c=v.createDocumentFragment();for(let o in r){let e=v.createElement('li'),t=v.createElement('a'),l=v.createElement('input'),n=v.createElement('div'),a=v.createElement('div'),i=v.createElement('div'),s=v.createElement('div');a.className='tb_arrow tb_up_row',i.className='tb_drag_opt tb_no_sort tf_h',s.className='tb_arrow tb_down_row',n.className='tb_move_opt',a.title=ThemifyConstructor.label.up,s.title=ThemifyConstructor.label.down,n.append(a,i,s),l.type='text',l.className='tb_multi_option',l.value=r[o],t.className='tb_contact_value_remove tb_ui_icon_link tf_close',t.href='#',e.append(n,l,t),c.appendChild(e)}return c},_default(e,t){if('text'===t||'textarea'===t||'tel'===t||'number'===t||'email'===t){const s='textarea'===t?t:'input';return this.getText(e,t,s)}const l=v.createElement('ul'),n=v.createElement('a'),a=v.createDocumentFragment(),i=e.value||[''];return l.appendChild(this.getOptions(i)),n.href='#',n.className='tb_add_field_option tb_ui_icon_link',n.textContent=tb_contact_l10n.add_option,this.setType(n,t),a.append(l,n),a}},addField(e){const t=0===Object.keys(e).length,l=e.type||'text',n=v.createElement('tr'),a=v.createElement('td'),i=v.createElement('td'),s=v.createElement('input'),o=v.createElement('td'),r=v.createElement('div'),c=v.createElement('select'),d=v.createDocumentFragment(),_=v.createElement('div'),p=v.createElement('div'),f=v.createElement('label'),b=v.createElement('input'),u=v.createElement('a'),h=v.createElement('span'),m=tb_contact_l10n.types,g='tb_'+y.Helper.generateUniqueID();_.className='control-input tf_rel',p.className='tb_new_field',r.className='selectwrapper tf_rel tf_inline_b tf_vmiddle',c.className='tb_new_field_type tb_lb_option',n.className='tb_contact_new_row',s.type='text',s.className='tb_new_field_textbox',s.value=e.label===w?1==t?tb_contact_l10n.field_name:'':e.label.replace(/&quot;/g,'"'),s.dataset.id=e.id===w?'':e.id,s.dataset.order=e.order===w?'':e.order,b.type='checkbox',b.className='tb_new_field_required',b.value='required','static'===l&&(f.style.display='none'),!0===e.required&&(b.checked=!0),o.setAttribute('colspan','2'),a.appendChild(s),n.appendChild(a);for(let t in m){let e=v.createElement('option');e.name=g,t===l&&(e.selected='selected'),e.value=t,e.textContent=m[t],d.appendChild(e)}return c.appendChild(d),r.appendChild(c),_.appendChild(this.render.call(e,l)),f.append(b,v.createTextNode(tb_contact_l10n.req)),p.append(_,f),p.append(this.render.icon(e.icon)),o.append(r,p),i.appendChild(u),u.className='tb_contact_field_remove tf_close tb_ui_icon_link',u.href='#',n.append(o,i),h.appendChild(v.createTextNode('%'+s.value+'%')),y.LightBox.el.querySelector('.tb_contact_custom_tags').appendChild(h),s.tfOn('change',function(){h.textContent='%'+this.value+'%'},{passive:!0}),n},switchField(e){const t=e.value,l=e.closest('td').tfClass('control-input')[0],n=l.closest('.tb_new_field').tfClass('tb_new_field_required')[0].parentNode;for(;l.firstChild;)l.lastChild.remove();l.appendChild(this.render.call({},t)),n.style.display='static'===t?'none':'','radio'!==t&&'select'!==t&&'checkbox'!==t||this.sortableFieldItems()},changeObject(e){const o=this.$table[0].tfTag('tbody')[0].tfTag('tr'),r={fields:[]},t={};for(let s=0,e=o.length;s<e;++s)if(o[s].classList.contains('tb_contact_new_row')){let n=o[s].tfClass('tb_new_field_type')[0].options[o[s].tfClass('tb_new_field_type')[0].selectedIndex].value,t=o[s].tfClass('tb_new_field_textbox')[0].value.trim(),l='static'!==n&&!0===o[s].tfClass('tb_new_field_required')[0].checked,a=o[s].tfClass('themify_field_icon')[0].value.trim(),i;switch(n){case'text':case'email':case'number':case'textarea':case'static':case'tel':i=o[s].tfClass('tb_new_field_value')[0].value.trim();break;case'radio':case'select':case'checkbox':i=[];let l=o[s].tfClass('control-input')[0].tfTag('input');for(let t=0,e=l.length;t<e;++t){let e=l[t].value.trim();''===e&&'select'!==n||i.push(e)}break}if(''!==i&&i!==w||''!==t){let e={type:n,order:s,icon:a};l&&(e.required=l),''!==t?e.label=t.replace(/"/g,'&quot;'):e.id='ex'+s,i!==w&&''!==i&&0<i.length&&('static'===n?i=i.replace(/"/g,'\\\\"'):'text'!==n&&'textarea'!==n||(i=i.replace(/"/g,'&quot;')),'static'!==n&&'textarea'!==n||(i=i.replace(/\n/g,'\\\\n')),e.value=i),r.fields.push(e)}}else if(!o[s].classList.contains('tb_no_sort')){let e=o[s].tfClass('tb_lb_option')[0].id;t[e]=s}const l=y.LightBox.el.querySelector('#field_extra'),n=JSON.stringify(t);l.value=JSON.stringify(r),y.LightBox.el.querySelector('#field_order').value=n,this.app.settings.field_order=n,e||C.triggerEvent(l,'change')}},y.jsModuleLoaded().then(()=>{if(ThemifyConstructor.contact_fields={render(e,a){window.top.Themify.fonts('ti-split-v');let i=v.createElement('tr');const l=v.createElement('table'),t=v.createElement('thead'),n=v.createElement('tbody'),s=v.createElement('tfoot'),o=v.createDocumentFragment(),r=e.options.head,c=e.options.body,d=e.options.foot,_=function(e,t,l){const n={id:'field_'+e,placeholder:t,type:'text'};return l&&(n.help=l),a.create([n])},p=function(e){const t={id:'field_'+e,new_line:!0,type:'checkbox',options:[{value:'',name:'yes'}]};return'sendcopy_active'===e?t.binding={checked:{show:'field_sendcopy_subject'},not_checked:{hide:'field_sendcopy_subject'}}:'optin_active'===e&&(t.binding={checked:{show:'optin'},not_checked:{hide:'optin'}}),a.create([t])};for(let t in r){let e=v.createElement('th');'l'===t&&(e.colSpan=2),e.textContent=r[t],i.appendChild(e)}t.appendChild(i);for(let n in c){i=v.createElement('tr');for(let e in r){let t=v.createElement('td'),l=null;if('f'===e)l=v.createElement('span'),t.textContent=c[n];else if('l'===e){t.colSpan='2';let e;var f;(e=_(n+'_label',c[n])).appendChild(_(n+'_placeholder',tb_contact_l10n.pl)),e.appendChild(function(e){const t=a.create([{type:'icon',id:e,after:ThemifyConstructor.label.icon}]),l=v.createElement('span');return l.className='tb_input_after',l.textContent=ThemifyConstructor.label.icon,t.querySelector('.tb_field').append(l),t}(n+'_icon')),l='message'!==n?(m=v.createDocumentFragment(),f=p(n+'_require'),m.appendChild(e),f.querySelector('.tb_lb_option').appendChild(v.createTextNode(tb_contact_l10n.req)),m.appendChild(f),m):e}else'sh'===e&&(l=p(n+'_active'));null!==l&&t.appendChild(l),i.appendChild(t)}o.appendChild(i)}i=v.createElement('tr');const b=v.createElement('td'),u=v.createElement('a'),h=v.createElement('span');u.className='tb_new_field_action',u.href='#',h.className='tf_plus_icon tf_rel',u.append(h,v.createTextNode(e.new_row)),b.setAttribute('colspan','4'),b.appendChild(u),i.className='tb_no_sort',i.appendChild(b),o.appendChild(i),n.appendChild(o);for(let n in d)if('align'!==n){i=v.createElement('tr');for(let t in r)if('sh'!==t||'send'!==n){let e=v.createElement('td'),l=null;if('f'===t)e.textContent=d[n];else if('l'===t){e.colSpan=2;let t=_(n+'_label',d[n]);if('send'===n){e.colSpan=3;var m=v.createDocumentFragment(),g=a.select.render({id:d.align.id,options:d.align.options},a);m.append(t,g,v.createTextNode(d.align.label));const y=a.create([{id:'send_icon',after:ThemifyConstructor.label.icon,type:'icon',wrap_class:'tb_disable_dc'}]),x=v.createElement('span');x.className='tb_input_after',x.textContent=ThemifyConstructor.label.icon,y.querySelector('.tb_field').append(x),m.append(y),l=m}else if('optin'===n){l=v.createDocumentFragment();let e=ThemifyConstructor.create([{type:'optin_provider',id:'optin'}]);l.append(t,e)}else l=t;m.appendChild(f)}else'sh'===t&&'send'!==n&&(l=p(n+'_active'),'captcha'===n&&''!==tb_contact_l10n.captcha&&l.querySelector('input').tfOn('change',function(e){let t=this.closest('td').previousElementSibling;if(!0===this.checked){const l=v.createElement('div');l.className='tb_captcha_message tb_field_error_msg',l.innerHTML=tb_contact_l10n.captcha,t.appendChild(l)}else{let e=t.tfClass('tb_captcha_message')[0];e!==w&&e.parentNode.removeChild(e)}},{passive:!0}));null!==l&&e.appendChild(l),'l'===t&&'sendcopy'===n&&e.appendChild(a.create([{id:'field_'+n+'_subject',after:tb_contact_l10n.sendcopy_sub,type:'text',class:'small'}])),i.appendChild(e)}o.appendChild(i)}return s.appendChild(o),l.className='contact_fields',l.append(t,n,s),C.on('tb_editing_contact_setting',e=>{const t=e.querySelector('#template');''===t.value&&(t.value=tb_contact_l10n.default_template),E=new N(l,a),C.on('themify_builder_lightbox_close',()=>{E=null},!0)},!0),l}},'visual'===y.mode){class e extends y.BaseInLineEdit{constructor(){super()}save(a,i,e,t,l,n){const s=i,o=s.closest('.builder-contact-field-extra');if(null===o)return t;{let n=-1;for(let e=a.el.tfClass('builder-contact-field-extra'),t=e.length-1;-1<t;--t)if(e[t]===o){n=t;break}if(-1!==n){const r=i.closest('.control-input');let l=-1;if(null!==r)for(let e=r.children,t=e.length-1;-1<t;--t)if(e[t].contains(i)){l=t;break}if(E){let e=y.LightBox.el.tfClass('tb_new_field_textbox')[n];e!==w&&((e=-1!==l?e.closest('tr').querySelectorAll('.control-input li')[l].tfClass('tb_multi_option')[0]:e).value=t,E.changeObject(!0))}else{const c=a.get('mod_settings'),d='string'==typeof c.field_extra?JSON.parse(c.field_extra):c.field_extra;if(d.fields&&d.fields[n]!==w){const _=d.fields[n];if(null!==r){if(!_.value||-1===l||_.value[l]===w)return!1;_.value[l]=t}else _.label=t;c.fieldExtra=d,a.set('mod_settings',c)}}}return!1}}}new e}y.Forms.registerValidator('tb_contact_recipient',e=>!!y.LightBox.el.querySelector('#send_to_admins .tb_checkbox:checked')||''!==e.value.trim()&&y.Forms.getValidator('email')(e))}),C.on('themify_builder_ready',()=>{C.requestIdleCallback(()=>{let e=window.top.document.tfId('themify-builder-lightbox-css');e=e&&e.nextElementSibling,window.top.Themify.loadCss(tb_contact_l10n.admin_css,null,tb_contact_l10n.v,e)},-1,1500)},!0,y.is_builder_ready)})(jQuery,tb_app,Themify,document,void 0);